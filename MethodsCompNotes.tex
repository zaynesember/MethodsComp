% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\title{Methods Comp Notes}
\author{Zayne Sember}
\date{3/29/2022}

\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Methods Comp Notes},
  pdfauthor={Zayne Sember},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{xcolor}
\usepackage{siunitx}
\newcolumntype{d}{S[input-symbols = ()]}
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi

\begin{document}
\maketitle

\hypertarget{poli-204b}{%
\section{POLI 204B}\label{poli-204b}}

\hypertarget{hypothesis-testing}{%
\subsection{Hypothesis Testing}\label{hypothesis-testing}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Set some threshold, \(\alpha\), at or below which you deem a p-value
  significant
\item
  Define the null hypothesis, \(H_0\)
\item
  Define the alternative hypothesis, \(H_A\), either two-tailed or
  one-tailed
\item
  Calculate a test statistic such as Z-score or t-test and check the
  p-value
\item
  Draw conclusions
\end{enumerate}

Some hypothesis tests in R

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ONE SAMPLE T{-}}\AlertTok{TEST}
\CommentTok{\# How likely is it that the mean of some population from which we take a normal sample, x, is greater than some number, mu?}

\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{)}
\FunctionTok{t.test}\NormalTok{(x, }\AttributeTok{mu=}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  One Sample t-test
## 
## data:  x
## t = -48.777, df = 99, p-value < 2.2e-16
## alternative hypothesis: true mean is not equal to 5
## 95 percent confidence interval:
##  -0.1199148  0.2803502
## sample estimates:
##  mean of x 
## 0.08021768
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# WELCH TWO{-}SAMPLE T{-}}\AlertTok{TEST}
\CommentTok{\# How likely is it that the means of two populations differ based on two normal samples of equal variance, x and y?}

\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{)}
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{)}

\FunctionTok{t.test}\NormalTok{(x, y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Welch Two Sample t-test
## 
## data:  x and y
## t = 0.55166, df = 197.99, p-value = 0.5818
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -0.1962811  0.3487518
## sample estimates:
##   mean of x   mean of y 
## -0.06493332 -0.14116866
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# TWO PROPORTION Z{-}}\AlertTok{TEST}
\CommentTok{\# Is there a significant difference in proportions between two populations given normal samples of them, x and y?}

\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{)}
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{)}

\CommentTok{\# Assuming we want to test whether the share of values greater than zero differs between the two populations}
\NormalTok{x\_count }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(x[x}\SpecialCharTok{\textgreater{}}\DecValTok{0}\NormalTok{])}
\NormalTok{y\_count }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(y[y}\SpecialCharTok{\textgreater{}}\DecValTok{0}\NormalTok{])}

\FunctionTok{prop.test}\NormalTok{(}\AttributeTok{x=}\FunctionTok{c}\NormalTok{(x\_count,y\_count), }\AttributeTok{n=}\FunctionTok{c}\NormalTok{(}\FunctionTok{length}\NormalTok{(x), }\FunctionTok{length}\NormalTok{(y)), }\AttributeTok{alternative=}\StringTok{"two.sided"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  2-sample test for equality of proportions with continuity correction
## 
## data:  c(x_count, y_count) out of c(length(x), length(y))
## X-squared = 0.32158, df = 1, p-value = 0.5707
## alternative hypothesis: two.sided
## 95 percent confidence interval:
##  -0.19807665  0.09807665
## sample estimates:
## prop 1 prop 2 
##   0.44   0.49
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# CHI{-}SQUARED }\AlertTok{TEST}
\CommentTok{\# Are two variables independent? Useful for testing relationships between categorical variables}

\CommentTok{\#  For example, if you were investigating the relationship between occupation and party preference, and 35\% of voters were Democrats, 32\% were Independents, and 33\% were Republicans, independence implies the same partisan breakdown across all occupational categories (35, 32, and 33).}

\NormalTok{data\_frame }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"https://goo.gl/j6lRXD"}\NormalTok{)}

\FunctionTok{table}\NormalTok{(data\_frame}\SpecialCharTok{$}\NormalTok{treatment, data\_frame}\SpecialCharTok{$}\NormalTok{improvement)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##              
##               improved not-improved
##   not-treated       26           29
##   treated           35           15
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{chisq.test}\NormalTok{(data\_frame}\SpecialCharTok{$}\NormalTok{treatment, data\_frame}\SpecialCharTok{$}\NormalTok{improvement, }\AttributeTok{correct=}\ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Pearson's Chi-squared test
## 
## data:  data_frame$treatment and data_frame$improvement
## X-squared = 5.5569, df = 1, p-value = 0.01841
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# DIFFERENCE BETWEEN VARIANCES }\AlertTok{TEST}
\CommentTok{\# Is the variance between two normal samples, x and y, drawn from populations significantly different?}

\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{, }\AttributeTok{sd=}\DecValTok{3}\NormalTok{)}
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{121}\NormalTok{, }\AttributeTok{sd=}\FloatTok{3.5}\NormalTok{)}

\FunctionTok{var.test}\NormalTok{(x, y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  F test to compare two variances
## 
## data:  x and y
## F = 0.71324, num df = 99, denom df = 120, p-value = 0.0825
## alternative hypothesis: true ratio of variances is not equal to 1
## 95 percent confidence interval:
##  0.490271 1.044850
## sample estimates:
## ratio of variances 
##          0.7132415
\end{verbatim}

\hypertarget{properties-of-estimators}{%
\subsection{Properties of Estimators}\label{properties-of-estimators}}

\hypertarget{unbiasedness}{%
\subsubsection{Unbiasedness}\label{unbiasedness}}

\(E(\hat{\theta}) - \theta = 0\)

\hypertarget{asymptotic-unbiasedness}{%
\subsubsection{Asymptotic Unbiasedness}\label{asymptotic-unbiasedness}}

As \(n\) gets bigger, the estimator's biasedness goes to zero
\(\lim_{n\to\infty} P(|E[\hat{\theta}] - \theta| > \epsilon) \to 0; \forall\epsilon >0\)

\hypertarget{efficiency}{%
\subsubsection{Efficiency}\label{efficiency}}

The estimator needs fewer observations to achieve better error
performance \(\frac{1}{MSE}=\frac{1}{E[(\hat{\theta}-\theta)^2]}\)

\hypertarget{consistency}{%
\subsubsection{Consistency}\label{consistency}}

The distribution of estimates converges on the true value as \(n\) gets
bigger
\(\lim_{n\to\infty} P(|\hat{\theta} - \theta| > \epsilon) \to 0; \forall\epsilon >0\)

\hypertarget{correlation}{%
\subsection{Correlation}\label{correlation}}

We define the correlation, \(r\), between two variables, \(x\) and
\(y\), to be:

\[r=\frac{\sum{Z_{xi}Z_{yi}}}{n-1}=\frac{\sum{(x_i-\bar{x})(y_i-\bar{y})}}{s_xs_y(n-1)}\]
where the standard deviation of \(x\) (and same for \(y\)) is:

\[s_x=\sqrt{\frac{\sum{(x_i-\bar{x})^2}}{n-1}}\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\AttributeTok{n=}\DecValTok{100}\NormalTok{, }\AttributeTok{mean=}\DecValTok{2}\NormalTok{, }\AttributeTok{sd=}\DecValTok{3}\NormalTok{)}
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\AttributeTok{n=}\DecValTok{100}\NormalTok{, }\AttributeTok{mean=}\SpecialCharTok{{-}}\DecValTok{3}\NormalTok{, }\AttributeTok{sd=}\DecValTok{2}\NormalTok{)}

\FunctionTok{cor}\NormalTok{(x,y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -0.011581
\end{verbatim}

\hypertarget{regression-basics}{%
\subsection{Regression Basics}\label{regression-basics}}

Ordinary least squares regression seeks to minimize the the vertical
distances, \(\epsilon\), between the data being fitted and some line of
best fit with some slope (in the bivariate case), \(\beta_1\), and some
intercept, \(\beta_0\).

The model we want to fit to:

\[y_i=\beta_0+\beta_1x_i+\epsilon_i\]

The model we estimate:

\[y_i=\hat{\beta_0}+\hat{\beta_1}x_i+e_i\] The residuals, \(e_i\), are
an estimate of the error (distance between true line and y\_i).

The residual sum of squares (RSS) is defined as:
\[RSS=\sum e_i^2=\sum(y_i-\hat{y_i})^2\]

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# If we have some lm model we can get the RSS as follows:}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\AttributeTok{n=}\DecValTok{100}\NormalTok{, }\AttributeTok{mean=}\DecValTok{2}\NormalTok{, }\AttributeTok{sd=}\DecValTok{3}\NormalTok{)}
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\AttributeTok{n=}\DecValTok{100}\NormalTok{, }\AttributeTok{mean=}\SpecialCharTok{{-}}\DecValTok{3}\NormalTok{, }\AttributeTok{sd=}\DecValTok{2}\NormalTok{)}

\NormalTok{model }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x)}

\FunctionTok{deviance}\NormalTok{(model)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 344.8536
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# or}

\FunctionTok{sum}\NormalTok{(}\FunctionTok{resid}\NormalTok{(model)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 344.8536
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Or without an lm model:}

\NormalTok{rss }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(y, y\_hat)\{}
  \FunctionTok{return}\NormalTok{(}\FunctionTok{sum}\NormalTok{((y}\SpecialCharTok{{-}}\NormalTok{y\_hat)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{))}
\NormalTok{\}}

\NormalTok{y\_hat }\OtherTok{\textless{}{-}} \FunctionTok{fitted}\NormalTok{(model)}

\FunctionTok{rss}\NormalTok{(y, y\_hat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 344.8536
\end{verbatim}

The regression sum of squares (RSS) (AKA sum of squares of regression
(SSR), explained sum of squares (ESS)) is defined as:
\[RegSS=\sum(\hat{y_i}-\bar{y})^2\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\AttributeTok{n=}\DecValTok{100}\NormalTok{, }\AttributeTok{mean=}\DecValTok{2}\NormalTok{, }\AttributeTok{sd=}\DecValTok{3}\NormalTok{)}
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\AttributeTok{n=}\DecValTok{100}\NormalTok{, }\AttributeTok{mean=}\SpecialCharTok{{-}}\DecValTok{3}\NormalTok{, }\AttributeTok{sd=}\DecValTok{2}\NormalTok{)}

\NormalTok{model }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x)}

\NormalTok{y\_hat }\OtherTok{\textless{}{-}} \FunctionTok{fitted}\NormalTok{(model)}

\NormalTok{regSS }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(y\_hat, y)\{}
  \FunctionTok{return}\NormalTok{(}\FunctionTok{sum}\NormalTok{((y\_hat}\SpecialCharTok{{-}}\FunctionTok{mean}\NormalTok{(y))}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{))}
\NormalTok{\}}

\FunctionTok{regSS}\NormalTok{(y\_hat, y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5.399105
\end{verbatim}

The total sum of squares (TSS) is defined as:
\[TSS=\sum(y_i-\bar{y})^2\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\AttributeTok{n=}\DecValTok{100}\NormalTok{, }\AttributeTok{mean=}\SpecialCharTok{{-}}\DecValTok{3}\NormalTok{, }\AttributeTok{sd=}\DecValTok{2}\NormalTok{)}

\NormalTok{TSS }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(y)\{}
  \FunctionTok{return}\NormalTok{(}\FunctionTok{sum}\NormalTok{((y}\SpecialCharTok{{-}}\FunctionTok{mean}\NormalTok{(y))}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{))}
\NormalTok{\}}

\FunctionTok{TSS}\NormalTok{(y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 445.7826
\end{verbatim}

The ratio of RegSS to TSS is our \(r^2\), the share of variance in \(y\)
that is explained by \(x\):
\[r^2=\frac{RegSS}{TSS}=\frac{\sum(\hat{y_i}-\bar{y})^2}{\sum(y_i-\bar{y})^2}\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\AttributeTok{n=}\DecValTok{100}\NormalTok{, }\AttributeTok{mean=}\DecValTok{2}\NormalTok{, }\AttributeTok{sd=}\DecValTok{3}\NormalTok{)}
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\AttributeTok{n=}\DecValTok{100}\NormalTok{, }\AttributeTok{mean=}\SpecialCharTok{{-}}\DecValTok{3}\NormalTok{, }\AttributeTok{sd=}\DecValTok{2}\NormalTok{)}

\NormalTok{model }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x)}

\FunctionTok{summary}\NormalTok{(model)}\SpecialCharTok{$}\NormalTok{r.squared}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.03913119
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# or}

\NormalTok{y\_hat }\OtherTok{\textless{}{-}} \FunctionTok{fitted}\NormalTok{(model)}

\NormalTok{rsquared }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(y, y\_hat)\{}
  \FunctionTok{return}\NormalTok{(}\FunctionTok{sum}\NormalTok{((y\_hat}\SpecialCharTok{{-}}\FunctionTok{mean}\NormalTok{(y))}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}\SpecialCharTok{/}\FunctionTok{sum}\NormalTok{((y}\SpecialCharTok{{-}}\FunctionTok{mean}\NormalTok{(y))}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{))}
\NormalTok{\}}

\FunctionTok{rsquared}\NormalTok{(y, y\_hat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.03913119
\end{verbatim}

\hypertarget{calculating-bivariate-regression-by-hand-linear-method}{%
\subsubsection{Calculating bivariate regression by hand (linear
method)}\label{calculating-bivariate-regression-by-hand-linear-method}}

\hypertarget{step-1}{%
\paragraph{Step 1}\label{step-1}}

Given the vectors \(X\) and \(Y\), find \(X^2\), \(XY\), and the sums of
all of the preceding vectors

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{calc\_x2xy }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y)\{}
\NormalTok{  df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x=}\NormalTok{x,}\AttributeTok{y=}\NormalTok{y)}
  
\NormalTok{  df}\SpecialCharTok{$}\NormalTok{xsquared }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{\^{}}\DecValTok{2}
\NormalTok{  df}\SpecialCharTok{$}\NormalTok{xy }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{*}\NormalTok{y}
  
\NormalTok{  totals }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{sum}\NormalTok{(x), }\FunctionTok{sum}\NormalTok{(y), }\FunctionTok{sum}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{xsquared), }\FunctionTok{sum}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{xy))}
  
\NormalTok{  df }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(df, totals)}
  \FunctionTok{rownames}\NormalTok{(df) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(x),}\StringTok{"total"}\NormalTok{)}
  
  \FunctionTok{return}\NormalTok{(df)}
\NormalTok{\}}

\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\AttributeTok{n=}\DecValTok{7}\NormalTok{, }\AttributeTok{mean=}\DecValTok{2}\NormalTok{, }\AttributeTok{sd=}\DecValTok{3}\NormalTok{)}
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\AttributeTok{n=}\DecValTok{7}\NormalTok{, }\AttributeTok{mean=}\SpecialCharTok{{-}}\DecValTok{3}\NormalTok{, }\AttributeTok{sd=}\DecValTok{2}\NormalTok{)}

\NormalTok{df\_step1 }\OtherTok{\textless{}{-}} \FunctionTok{calc\_x2xy}\NormalTok{(}\AttributeTok{x=}\NormalTok{x,}\AttributeTok{y=}\NormalTok{y)}
\NormalTok{df\_step1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                x           y    xsquared          xy
## 1      7.4039370  -1.1445848  54.8182830  -8.4744335
## 2      1.7788690   0.8053083   3.1643748   1.4325379
## 3      0.4651401  -4.5427678   0.2163553  -2.1130234
## 4     -4.9581280  -3.9371908  24.5830329  19.5210959
## 5      3.3341701  -3.6299097  11.1166902 -12.1027365
## 6      5.6957309  -2.3785524  32.4413506 -13.5475943
## 7      1.4103995  -0.2292384   1.9892267  -0.3233177
## total 15.1301186 -15.0569356 128.3293136 -15.6074718
\end{verbatim}

\hypertarget{step-2}{%
\paragraph{Step 2}\label{step-2}}

Calculate \(\hat\beta_1\) and \(\hat\beta_0\):
\[\hat\beta_1=\frac{N\sum x_iy_i-\sum x_i\sum y_i}{N\sum x_i^2-(\sum x_i)^2}\]
\[\hat\beta_0=\frac{\sum y_i -\hat\beta_1\sum x_i}{N}\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{calc\_beta1 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(df)\{}
\NormalTok{  totals }\OtherTok{\textless{}{-}} \FunctionTok{tail}\NormalTok{(df,}\AttributeTok{n=}\DecValTok{1}\NormalTok{)}
\NormalTok{  N }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(df[[}\DecValTok{1}\NormalTok{]])}\SpecialCharTok{{-}}\DecValTok{1}
  
\NormalTok{  df }\OtherTok{\textless{}{-}} \FunctionTok{head}\NormalTok{(df,}\AttributeTok{n=}\NormalTok{N)}
\NormalTok{  N }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{x}\DecValTok{{-}1}\NormalTok{) }\CommentTok{\# {-}1 bc row totals amended}
  
\NormalTok{  beta1 }\OtherTok{\textless{}{-}}\NormalTok{ (N}\SpecialCharTok{*}\NormalTok{totals}\SpecialCharTok{$}\NormalTok{xy }\SpecialCharTok{{-}}\NormalTok{ (totals}\SpecialCharTok{$}\NormalTok{x}\SpecialCharTok{*}\NormalTok{totals}\SpecialCharTok{$}\NormalTok{y))}\SpecialCharTok{/}\NormalTok{((N}\SpecialCharTok{*}\NormalTok{totals}\SpecialCharTok{$}\NormalTok{xsquared)}\SpecialCharTok{{-}}\NormalTok{(totals}\SpecialCharTok{$}\NormalTok{x)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
  \FunctionTok{return}\NormalTok{(beta1)}
\NormalTok{\}}

\NormalTok{calc\_beta0 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(df, beta1)\{}
\NormalTok{  totals }\OtherTok{\textless{}{-}} \FunctionTok{tail}\NormalTok{(df,}\AttributeTok{n=}\DecValTok{1}\NormalTok{)}
\NormalTok{  N }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(df[[}\DecValTok{1}\NormalTok{]])}\SpecialCharTok{{-}}\DecValTok{1}
  
\NormalTok{  beta0 }\OtherTok{\textless{}{-}}\NormalTok{ (totals}\SpecialCharTok{$}\NormalTok{y }\SpecialCharTok{{-}}\NormalTok{ (beta1}\SpecialCharTok{*}\NormalTok{totals}\SpecialCharTok{$}\NormalTok{x))}\SpecialCharTok{/}\NormalTok{N}
  \FunctionTok{return}\NormalTok{(beta0)}
\NormalTok{\}}

\NormalTok{beta1 }\OtherTok{\textless{}{-}} \FunctionTok{calc\_beta1}\NormalTok{(}\AttributeTok{df=}\NormalTok{df\_step1)}
\NormalTok{beta1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.1771193
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{beta0 }\OtherTok{\textless{}{-}} \FunctionTok{calc\_beta0}\NormalTok{(}\AttributeTok{df=}\NormalTok{df\_step1, }\AttributeTok{beta1=}\NormalTok{beta1)}
\NormalTok{beta0}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -2.533824
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# check with:}
\CommentTok{\# lm(y\textasciitilde{}x)}
\end{Highlighting}
\end{Shaded}

\hypertarget{step-3}{%
\paragraph{Step 3}\label{step-3}}

Next, calculate \(x-\bar x\), \((x- \bar x)^2\), \(y-\bar y\),
\((y-\bar y)^2\), and \((x-\bar x)(y-\bar y)\).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{calc\_r\_table }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y)\{}
\NormalTok{  N }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(x)}
\NormalTok{  df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x=}\NormalTok{x,}\AttributeTok{y=}\NormalTok{y)}
  
\NormalTok{  df}\SpecialCharTok{$}\NormalTok{x\_minus\_xbar }\OtherTok{\textless{}{-}}\NormalTok{ df}\SpecialCharTok{$}\NormalTok{x }\SpecialCharTok{{-}}  \FunctionTok{mean}\NormalTok{(x)}
\NormalTok{  df}\SpecialCharTok{$}\NormalTok{x\_minus\_xbar\_sq }\OtherTok{\textless{}{-}}\NormalTok{ (df}\SpecialCharTok{$}\NormalTok{x\_minus\_xbar)}\SpecialCharTok{\^{}}\DecValTok{2}
  
\NormalTok{  df}\SpecialCharTok{$}\NormalTok{y\_minus\_ybar }\OtherTok{\textless{}{-}}\NormalTok{ df}\SpecialCharTok{$}\NormalTok{y }\SpecialCharTok{{-}}  \FunctionTok{mean}\NormalTok{(y)}
\NormalTok{  df}\SpecialCharTok{$}\NormalTok{y\_minus\_ybar\_sq }\OtherTok{\textless{}{-}}\NormalTok{ (df}\SpecialCharTok{$}\NormalTok{y\_minus\_ybar)}\SpecialCharTok{\^{}}\DecValTok{2}
  
\NormalTok{  df}\SpecialCharTok{$}\NormalTok{x\_minus\_xbar\_y\_minus\_ybar }\OtherTok{\textless{}{-}}\NormalTok{ df}\SpecialCharTok{$}\NormalTok{x\_minus\_xbar}\SpecialCharTok{*}\NormalTok{df}\SpecialCharTok{$}\NormalTok{y\_minus\_ybar}
  
  \FunctionTok{return}\NormalTok{(df)}
\NormalTok{\}}

\NormalTok{calc\_rsquared }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y)\{}
\NormalTok{  df }\OtherTok{\textless{}{-}} \FunctionTok{calc\_r\_table}\NormalTok{(x,y)}
\NormalTok{  N }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(x)}
  
\NormalTok{  sd\_x }\OtherTok{\textless{}{-}} \FunctionTok{sqrt}\NormalTok{((}\FunctionTok{sum}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{x\_minus\_xbar\_sq))}\SpecialCharTok{/}\NormalTok{(N}\DecValTok{{-}1}\NormalTok{))}
\NormalTok{  sd\_y }\OtherTok{\textless{}{-}} \FunctionTok{sqrt}\NormalTok{((}\FunctionTok{sum}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{y\_minus\_ybar\_sq))}\SpecialCharTok{/}\NormalTok{(N}\DecValTok{{-}1}\NormalTok{))}
  
\NormalTok{  r }\OtherTok{\textless{}{-}}\NormalTok{ (}\FunctionTok{sum}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{x\_minus\_xbar\_y\_minus\_ybar))}\SpecialCharTok{/}\NormalTok{((N}\DecValTok{{-}1}\NormalTok{)}\SpecialCharTok{*}\NormalTok{sd\_x}\SpecialCharTok{*}\NormalTok{sd\_y)}
  
  \FunctionTok{return}\NormalTok{(r}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\NormalTok{\}}

\FunctionTok{calc\_r\_table}\NormalTok{(}\AttributeTok{x=}\NormalTok{x,}\AttributeTok{y=}\NormalTok{y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##            x          y x_minus_xbar x_minus_xbar_sq y_minus_ybar
## 1  7.4039370 -1.1445848    5.2424915      27.4837169    1.0064060
## 2  1.7788690  0.8053083   -0.3825765       0.1463648    2.9562991
## 3  0.4651401 -4.5427678   -1.6963054       2.8774521   -2.3917770
## 4 -4.9581280 -3.9371908   -7.1195735      50.6883265   -1.7862000
## 5  3.3341701 -3.6299097    1.1727246       1.3752830   -1.4789189
## 6  5.6957309 -2.3785524    3.5342854      12.4911733   -0.2275616
## 7  1.4103995 -0.2292384   -0.7510460       0.5640701    1.9217524
##   y_minus_ybar_sq x_minus_xbar_y_minus_ybar
## 1      1.01285310                 5.2760750
## 2      8.73970425                -1.1310107
## 3      5.72059713                 4.0571843
## 4      3.19051047                12.7169822
## 5      2.18720125                -1.7343646
## 6      0.05178427                -0.8042676
## 7      3.69313231                -1.4433245
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{calc\_rsquared}\NormalTok{(}\AttributeTok{x=}\NormalTok{x,}\AttributeTok{y=}\NormalTok{y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.1219688
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# check with:}
\CommentTok{\#summary(lm(y\textasciitilde{}x))$r.squared}
\end{Highlighting}
\end{Shaded}

\hypertarget{step-4}{%
\paragraph{Step 4}\label{step-4}}

Calculate the residuals, their square, and from that the estimated
standard error \[e_i=y_i-\hat y_i=y_i-\hat\beta_0-\hat\beta_1 x_i\]
\[\hat\sigma=\sqrt{\frac{\sum e_i^2}{N-2}}\]

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{calc\_residuals }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y, beta0, beta1)\{}
\NormalTok{  df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{e=}\NormalTok{y}\SpecialCharTok{{-}}\NormalTok{beta0}\SpecialCharTok{{-}}\NormalTok{(beta1}\SpecialCharTok{*}\NormalTok{x))}
\NormalTok{  df}\SpecialCharTok{$}\NormalTok{e\_squared }\OtherTok{\textless{}{-}}\NormalTok{ df}\SpecialCharTok{$}\NormalTok{e}\SpecialCharTok{\^{}}\DecValTok{2}
  
  \FunctionTok{return}\NormalTok{(df)}
\NormalTok{\}}

\NormalTok{calc\_sigma }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(e\_squared, N)\{}
  \FunctionTok{return}\NormalTok{(}\FunctionTok{sqrt}\NormalTok{(}\FunctionTok{sum}\NormalTok{(e\_squared)}\SpecialCharTok{/}\NormalTok{(N}\DecValTok{{-}2}\NormalTok{)))}
\NormalTok{\}}

\NormalTok{residuals }\OtherTok{\textless{}{-}} \FunctionTok{calc\_residuals}\NormalTok{(x, y, beta0, beta1)}
\NormalTok{residuals}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             e   e_squared
## 1  0.07785986 0.006062158
## 2  3.02406075 9.144943413
## 3 -2.09132863 4.373655452
## 4 -0.52518647 0.275820831
## 5 -1.68663105 2.844724292
## 6 -0.85355157 0.728550285
## 7  2.05477712 4.222109005
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# check with:}
\CommentTok{\#resid(lm(y\textasciitilde{}x))}

\NormalTok{sigma }\OtherTok{\textless{}{-}} \FunctionTok{calc\_sigma}\NormalTok{(residuals}\SpecialCharTok{$}\NormalTok{e\_squared, }\AttributeTok{N=}\FunctionTok{length}\NormalTok{(x))}
\NormalTok{sigma}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2.078262
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# check with:}
\CommentTok{\#summary(lm(y\textasciitilde{}x))$sigma}
\end{Highlighting}
\end{Shaded}

\hypertarget{calculating-bivariate-regression-by-hand-matrix-method}{%
\subsubsection{Calculating bivariate regression by hand (matrix
method)}\label{calculating-bivariate-regression-by-hand-matrix-method}}

Just calculate \(\hat\beta=(X'X)^{-1}X'Y\)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\AttributeTok{n=}\DecValTok{7}\NormalTok{, }\AttributeTok{mean=}\DecValTok{2}\NormalTok{, }\AttributeTok{sd=}\DecValTok{3}\NormalTok{)}
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\AttributeTok{n=}\DecValTok{7}\NormalTok{, }\AttributeTok{mean=}\SpecialCharTok{{-}}\DecValTok{3}\NormalTok{, }\AttributeTok{sd=}\DecValTok{2}\NormalTok{)}

\FunctionTok{print}\NormalTok{(}\StringTok{"Append ones to X"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Append ones to X"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{X }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{length}\NormalTok{(x)),x), }\AttributeTok{nrow=}\FunctionTok{length}\NormalTok{(x))}
\NormalTok{X}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1]       [,2]
## [1,]    1  3.9235523
## [2,]    1  5.7315581
## [3,]    1  3.1254444
## [4,]    1  1.7175178
## [5,]    1 12.6795422
## [6,]    1  0.7067669
## [7,]    1  2.8635961
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\StringTok{"Define Y"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Define Y"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Y }\OtherTok{\textless{}{-}} \FunctionTok{as.matrix}\NormalTok{(y)}
\NormalTok{Y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##            [,1]
## [1,] -6.2552319
## [2,] -4.7557200
## [3,] -1.5515628
## [4,] -0.5459654
## [5,] -4.4535501
## [6,] -4.5246168
## [7,] -3.1176872
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\StringTok{"Get X\textquotesingle{}X"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Get X'X"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{t}\NormalTok{(X) }\SpecialCharTok{\%*\%}\NormalTok{ X}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##          [,1]      [,2]
## [1,]  7.00000  30.74798
## [2,] 30.74798 230.43378
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\StringTok{"Get the inversion of X\textquotesingle{}X"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Get the inversion of X'X"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{solve}\NormalTok{(}\FunctionTok{t}\NormalTok{(X) }\SpecialCharTok{\%*\%}\NormalTok{ X)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##            [,1]        [,2]
## [1,]  0.3451683 -0.04605760
## [2,] -0.0460576  0.01048535
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\StringTok{"Get X\textquotesingle{}Y"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Get X'Y"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{t}\NormalTok{(X) }\SpecialCharTok{\%*\%}\NormalTok{ Y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##            [,1]
## [1,]  -25.20433
## [2,] -126.18207
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\StringTok{"Get beta"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Get beta"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{solve}\NormalTok{(}\FunctionTok{t}\NormalTok{(X) }\SpecialCharTok{\%*\%}\NormalTok{ X) }\SpecialCharTok{\%*\%} \FunctionTok{t}\NormalTok{(X) }\SpecialCharTok{\%*\%}\NormalTok{ Y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##            [,1]
## [1,] -2.8880939
## [2,] -0.1622115
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# check with:}
\CommentTok{\#lm(y\textasciitilde{}x)}
\end{Highlighting}
\end{Shaded}

\hypertarget{multiple-regression}{%
\subsection{Multiple Regression}\label{multiple-regression}}

We now have multiple \(X\)s we need to fit to:

\[Y=\beta_0+\beta_1X_1+\beta_2X_2+\epsilon\]

We want to find the values of \(\beta_0\), \(\beta_1\), and \(\beta_2\)
that \textbf{minimizes} the sum of squared residuals (RSS):

\[RSS=\sum(\hat{y_i}-\bar{y})^2=\sum(\hat{y_i}-(\hat{\beta_0}+\hat\beta_1X_1+\hat\beta_2X_2)^2\]

\hypertarget{categorical-variables}{%
\subsection{Categorical Variables}\label{categorical-variables}}

When regressing on a categorical variable you leave one category out.
Coefficients are the impact of being \(X\) vs.~the excluded category,
all else equal.

\hypertarget{fixed-effects}{%
\subsection{Fixed Effects}\label{fixed-effects}}

Suppose we have data on 100 individuals in each of 100 countries
(\(n=10,000\)).

If we include a dummy to ``soak up'' the country effects we can
``isolate'' the differences between the individuals across countries. -
The estimated coefficients for each country typically aren't reported bc
they aren't relevant to our RQ

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(trade)}

\CommentTok{\# Without fixed effects}
\NormalTok{ols }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(}\FunctionTok{log}\NormalTok{(Euros) }\SpecialCharTok{\textasciitilde{}} \FunctionTok{log}\NormalTok{(dist\_km), }\AttributeTok{data=}\NormalTok{trade)}

\FunctionTok{summary}\NormalTok{(ols)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = log(Euros) ~ log(dist_km), data = trade)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -15.6809  -1.7347   0.5372   2.1699   7.1905 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  28.32169    0.16962  166.97   <2e-16 ***
## log(dist_km) -1.90965    0.02401  -79.54   <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 2.977 on 38323 degrees of freedom
## Multiple R-squared:  0.1417, Adjusted R-squared:  0.1417 
## F-statistic:  6326 on 1 and 38323 DF,  p-value: < 2.2e-16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# With fixed effects by country of origin and destination, product, and year}
\NormalTok{fe\_ols }\OtherTok{\textless{}{-}} \FunctionTok{feols}\NormalTok{(}\FunctionTok{log}\NormalTok{(Euros) }\SpecialCharTok{\textasciitilde{}} \FunctionTok{log}\NormalTok{(dist\_km) }\SpecialCharTok{|}\NormalTok{ Origin }\SpecialCharTok{+}\NormalTok{ Destination }\SpecialCharTok{+}\NormalTok{ Product }\SpecialCharTok{+}\NormalTok{ Year, trade)}

\FunctionTok{summary}\NormalTok{(fe\_ols)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## OLS estimation, Dep. Var.: log(Euros)
## Observations: 38,325 
## Fixed-effects: Origin: 15,  Destination: 15,  Product: 20,  Year: 10
## Standard-errors: Clustered (Origin) 
##              Estimate Std. Error  t value   Pr(>|t|)    
## log(dist_km) -2.16988   0.154283 -14.0642 1.1898e-09 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## RMSE: 1.74337     Adj. R2: 0.705139
##                 Within R2: 0.219322
\end{verbatim}

\hypertarget{interactions}{%
\subsection{Interactions}\label{interactions}}

Case 1: Interacting a dummy with another dummy - Coefficient is the
(estimated) change in the \emph{intercept} of the line of best fit
between units where both dummies are zero vs.~where they are both 1.

Case 2: Interacting a dummy with a continuous variable - Coefficient is
the difference in coefficient on the continuous variable when dummy is
on vs.~off.

Case 3: Interacting a continuous variable with another continuous
variable. - Don't try to interpret coefficient, look at an interaction
plot

Overall, an interaction tells us the \emph{impact} one variable has on
another variable's effect on the outcome. - Only include them when you
have a theoretical reason for doing so

\hypertarget{interaction-plots}{%
\subsubsection{Interaction plots}\label{interaction-plots}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{10}\NormalTok{)}

\CommentTok{\#create data frame}
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{gender =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{),}
                 \AttributeTok{exercise =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{1}\NormalTok{),}
                 \AttributeTok{weight\_loss =} \FunctionTok{rnorm}\NormalTok{(}\AttributeTok{n=}\DecValTok{10}\NormalTok{,}\AttributeTok{mean=}\DecValTok{2}\NormalTok{,}\AttributeTok{sd=}\DecValTok{3}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{motivation =}\NormalTok{ (}\FloatTok{2.5}\SpecialCharTok{*}\NormalTok{weight\_loss }\SpecialCharTok{+} \FunctionTok{rnorm}\NormalTok{(}\AttributeTok{n=}\DecValTok{10}\NormalTok{, }\AttributeTok{mean=}\DecValTok{3}\NormalTok{, }\AttributeTok{sd=}\DecValTok{3}\NormalTok{)))}
  
\FunctionTok{head}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   gender exercise weight_loss motivation
## 1      0        0   2.0562385  11.445935
## 2      0        0   1.4472424   8.885450
## 3      0        2  -2.1139916  -2.999680
## 4      1        1   0.2024969   6.468576
## 5      0        2   2.8836354  12.433259
## 6      1        0   3.1693829  11.191499
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(weight\_loss }\SpecialCharTok{\textasciitilde{}}\NormalTok{ gender}\SpecialCharTok{*}\NormalTok{exercise, }\AttributeTok{data=}\NormalTok{df)}
\FunctionTok{summary}\NormalTok{(model)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = weight_loss ~ gender * exercise, data = df)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.5614 -0.4690  0.3392  0.4711  2.4362 
## 
## Coefficients:
##                 Estimate Std. Error t value Pr(>|t|)
## (Intercept)       1.5126     0.8989   1.683    0.143
## gender            1.2290     1.6616   0.740    0.487
## exercise         -0.5326     0.7340  -0.726    0.495
## gender:exercise  -2.4921     1.3567  -1.837    0.116
## 
## Residual standard error: 1.614 on 6 degrees of freedom
## Multiple R-squared:  0.6062, Adjusted R-squared:  0.4094 
## F-statistic: 3.079 on 3 and 6 DF,  p-value: 0.1119
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Plot interaction of gender*exercise}
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{exercise, }\AttributeTok{y=}\NormalTok{weight\_loss, }\AttributeTok{color=}\FunctionTok{as.factor}\NormalTok{(gender))) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method=}\StringTok{"lm"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title=}\StringTok{"Interaction between gender and exercise"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_light}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using formula 'y ~ x'
\end{verbatim}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-13-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(weight\_loss }\SpecialCharTok{\textasciitilde{}}\NormalTok{ exercise}\SpecialCharTok{*}\NormalTok{motivation, }\AttributeTok{data=}\NormalTok{df)}
\FunctionTok{summary}\NormalTok{(model)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = weight_loss ~ exercise * motivation, data = df)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.71869 -0.35043 -0.00051  0.32748  0.86701 
## 
## Coefficients:
##                     Estimate Std. Error t value Pr(>|t|)  
## (Intercept)         -0.06532    0.74069  -0.088   0.9326  
## exercise            -0.80760    0.46780  -1.726   0.1350  
## motivation           0.21156    0.08136   2.600   0.0406 *
## exercise:motivation  0.06580    0.05181   1.270   0.2511  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.6528 on 6 degrees of freedom
## Multiple R-squared:  0.9356, Adjusted R-squared:  0.9033 
## F-statistic: 29.04 on 3 and 6 DF,  p-value: 0.0005709
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# To visualize an interaction between continuous variables you have to discretize}
\CommentTok{\# one of them, i.e. group those above and below the mean}
\NormalTok{df}\SpecialCharTok{$}\NormalTok{motivation\_groups }\OtherTok{\textless{}{-}} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{  df}\SpecialCharTok{$}\NormalTok{motivation }\SpecialCharTok{\textgreater{}} \FunctionTok{mean}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{motivation)}\SpecialCharTok{+}\FunctionTok{sd}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{motivation) }\SpecialCharTok{\textasciitilde{}} \StringTok{"high"}\NormalTok{,}
\NormalTok{  df}\SpecialCharTok{$}\NormalTok{motivation }\SpecialCharTok{\textless{}} \FunctionTok{mean}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{motivation)}\SpecialCharTok{+}\FunctionTok{sd}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{motivation) }\SpecialCharTok{\&}\NormalTok{ df}\SpecialCharTok{$}\NormalTok{motivation }\SpecialCharTok{\textgreater{}} \FunctionTok{mean}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{motivation)}\SpecialCharTok{{-}}\FunctionTok{sd}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{motivation) }\SpecialCharTok{\textasciitilde{}} \StringTok{"medium"}\NormalTok{,}
\NormalTok{  df}\SpecialCharTok{$}\NormalTok{motivation }\SpecialCharTok{\textless{}} \FunctionTok{mean}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{motivation)}\SpecialCharTok{{-}}\FunctionTok{sd}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{motivation) }\SpecialCharTok{\textasciitilde{}} \StringTok{"low"}
\NormalTok{)}

\CommentTok{\# Can plot the interactions manually}

\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{exercise, }\AttributeTok{y=}\NormalTok{weight\_loss, }\AttributeTok{color=}\FunctionTok{as.factor}\NormalTok{(motivation\_groups))) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method=}\StringTok{"lm"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title=}\StringTok{"Interaction between motivation and exercise"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_light}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using formula 'y ~ x'
\end{verbatim}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-13-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# OR with plot\_model}
\FunctionTok{plot\_model}\NormalTok{(model, }\AttributeTok{type =} \StringTok{"pred"}\NormalTok{, }\AttributeTok{terms =} \FunctionTok{c}\NormalTok{(}\StringTok{"exercise"}\NormalTok{, }\StringTok{"motivation"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_light}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-13-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot\_model}\NormalTok{(model, }\AttributeTok{type =} \StringTok{"int"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_light}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-13-4.pdf}

\hypertarget{regression-presentation}{%
\subsection{Regression Presentation}\label{regression-presentation}}

\hypertarget{regression-tables}{%
\subsubsection{Regression tables}\label{regression-tables}}

Pretty self-explanatory

\hypertarget{coefficient-plots}{%
\subsubsection{Coefficient Plots}\label{coefficient-plots}}

Easier to read than a Big Ugly Table of Numbers (BUTON) - Always include
95\% CI

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Source: https://bookdown.org/paul/applied{-}data{-}visualization/graph{-}coefficient{-}plots.html}

\NormalTok{fit }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(Fertility }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Catholic }\SpecialCharTok{+}\NormalTok{ Agriculture }\SpecialCharTok{+}\NormalTok{ Education, }\AttributeTok{data =}\NormalTok{ swiss) }\CommentTok{\# see ?swiss}
\NormalTok{results }\OtherTok{\textless{}{-}} \FunctionTok{tidy}\NormalTok{(fit)}
\NormalTok{fit\_cis\_95 }\OtherTok{\textless{}{-}} \FunctionTok{confint}\NormalTok{(fit, }\AttributeTok{level =} \FloatTok{0.95}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{data.frame}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\StringTok{"conf.low\_95"} \OtherTok{=} \StringTok{"X2.5.."}\NormalTok{,}
         \StringTok{"conf.high\_95"} \OtherTok{=} \StringTok{"X97.5.."}\NormalTok{)}
\NormalTok{fit\_cis\_90 }\OtherTok{\textless{}{-}} \FunctionTok{confint}\NormalTok{(fit, }\AttributeTok{level =} \FloatTok{0.90}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{data.frame}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\StringTok{"conf.low\_90"} \OtherTok{=} \StringTok{"X5.."}\NormalTok{,}
         \StringTok{"conf.high\_90"} \OtherTok{=} \StringTok{"X95.."}\NormalTok{)}
\NormalTok{results }\OtherTok{\textless{}{-}} \FunctionTok{bind\_cols}\NormalTok{(results, }
\NormalTok{                     fit\_cis\_95, }
\NormalTok{                     fit\_cis\_90) }\SpecialCharTok{\%\textgreater{}\%}
           \FunctionTok{rename}\NormalTok{(}\AttributeTok{Variable =}\NormalTok{ term,}
                  \AttributeTok{Coefficient =}\NormalTok{ estimate,}
                  \AttributeTok{SE =}\NormalTok{ std.error) }\SpecialCharTok{\%\textgreater{}\%}
           \FunctionTok{filter}\NormalTok{(Variable }\SpecialCharTok{!=} \StringTok{"(Intercept)"}\NormalTok{)}


\FunctionTok{ggplot}\NormalTok{(results, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Variable, }\AttributeTok{y =}\NormalTok{ Coefficient)) }\SpecialCharTok{+}
        \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{colour =} \FunctionTok{gray}\NormalTok{(}\DecValTok{1}\SpecialCharTok{/}\DecValTok{2}\NormalTok{), }\AttributeTok{lty =} \DecValTok{2}\NormalTok{) }\SpecialCharTok{+}
        \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Variable, }
                    \AttributeTok{y =}\NormalTok{ Coefficient)) }\SpecialCharTok{+} 
        \CommentTok{\# geom\_linerange(aes(x = Variable, }
        \CommentTok{\#              ymin = conf.low\_90,}
        \CommentTok{\#              ymax = conf.high\_90),}
        \CommentTok{\#            lwd = 1) +}
        \FunctionTok{geom\_linerange}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Variable, }
                     \AttributeTok{ymin =}\NormalTok{ conf.low\_95,}
                     \AttributeTok{ymax =}\NormalTok{ conf.high\_95),}
                   \AttributeTok{lwd =} \DecValTok{1}\SpecialCharTok{/}\DecValTok{2}\NormalTok{) }\SpecialCharTok{+} 
        \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Outcome: Fertility"}\NormalTok{) }\SpecialCharTok{+}
        \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme\_light}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-14-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# OR}

\FunctionTok{coefplot}\NormalTok{(fit)}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-14-2.pdf}

\hypertarget{predicted-value-plots}{%
\subsubsection{Predicted Value Plots}\label{predicted-value-plots}}

These plots convey the substantive importance of your findings; the
magnitude of the impact of your IVs on your DV

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x1=}\FunctionTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{6}\NormalTok{, }\DecValTok{7}\NormalTok{, }\DecValTok{8}\NormalTok{, }\DecValTok{11}\NormalTok{, }\DecValTok{12}\NormalTok{),}
                 \AttributeTok{x2=}\FunctionTok{c}\NormalTok{(}\DecValTok{6}\NormalTok{, }\DecValTok{6}\NormalTok{, }\DecValTok{7}\NormalTok{, }\DecValTok{7}\NormalTok{, }\DecValTok{8}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{11}\NormalTok{, }\DecValTok{13}\NormalTok{, }\DecValTok{14}\NormalTok{, }\DecValTok{14}\NormalTok{),}
                 \AttributeTok{x3=}\FunctionTok{c}\NormalTok{(}\DecValTok{15}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{8}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{6}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{),}
                 \AttributeTok{y=}\FunctionTok{c}\NormalTok{(}\DecValTok{22}\NormalTok{, }\DecValTok{24}\NormalTok{, }\DecValTok{24}\NormalTok{, }\DecValTok{25}\NormalTok{, }\DecValTok{25}\NormalTok{, }\DecValTok{27}\NormalTok{, }\DecValTok{29}\NormalTok{, }\DecValTok{31}\NormalTok{, }\DecValTok{32}\NormalTok{, }\DecValTok{36}\NormalTok{))}

\CommentTok{\#fit multiple linear regression model}
\NormalTok{model }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x1 }\SpecialCharTok{+}\NormalTok{ x2 }\SpecialCharTok{+}\NormalTok{x3, }\AttributeTok{data=}\NormalTok{df)}

\CommentTok{\#plot predicted vs. actual values}
\FunctionTok{ggplot}\NormalTok{(df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\FunctionTok{predict}\NormalTok{(model), }\AttributeTok{y=}\NormalTok{y)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_abline}\NormalTok{(}\AttributeTok{intercept=}\DecValTok{0}\NormalTok{, }\AttributeTok{slope=}\DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x=}\StringTok{\textquotesingle{}Predicted Values\textquotesingle{}}\NormalTok{, }\AttributeTok{y=}\StringTok{\textquotesingle{}Actual Values\textquotesingle{}}\NormalTok{, }
       \AttributeTok{title=}\StringTok{\textquotesingle{}Predicted vs. Actual Values\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_light}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-15-1.pdf}

\hypertarget{marginal-effects-plot}{%
\subsubsection{Marginal Effects Plot}\label{marginal-effects-plot}}

Another way to visualize the substantive meaning of your regression
coefficients, especially when interactions are involved.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(efc)}
\NormalTok{model }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(barthtot }\SpecialCharTok{\textasciitilde{}}\NormalTok{ c12hour }\SpecialCharTok{+}\NormalTok{ neg\_c\_7 }\SpecialCharTok{*}\NormalTok{ c161sex }\SpecialCharTok{+}\NormalTok{ e42dep, }\AttributeTok{data =}\NormalTok{ efc)}

\FunctionTok{ggpredict}\NormalTok{(model, }\AttributeTok{terms =} \StringTok{"c12hour"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # Predicted values of Total score BARTHEL INDEX
## 
## c12hour | Predicted |         95% CI
## ------------------------------------
##       0 |     69.02 | [67.30, 70.73]
##      20 |     66.98 | [65.59, 68.37]
##      45 |     64.44 | [63.19, 65.69]
##      65 |     62.41 | [61.00, 63.81]
##      85 |     60.37 | [58.64, 62.10]
##     105 |     58.34 | [56.17, 60.50]
##     125 |     56.30 | [53.66, 58.94]
##     170 |     51.72 | [47.92, 55.52]
## 
## Adjusted for:
## * neg_c_7 = 11.83
## * c161sex =  1.76
## *  e42dep =  2.93
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_predict }\OtherTok{\textless{}{-}} \FunctionTok{ggpredict}\NormalTok{(model, }\AttributeTok{terms =} \StringTok{"c12hour"}\NormalTok{)}
\FunctionTok{ggplot}\NormalTok{(df\_predict, }\FunctionTok{aes}\NormalTok{(x, predicted)) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_ribbon}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{ymin =}\NormalTok{ conf.low, }\AttributeTok{ymax =}\NormalTok{ conf.high), }\AttributeTok{alpha =}\NormalTok{ .}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-16-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# OR use plot\_model}
\FunctionTok{plot\_model}\NormalTok{(model, }\AttributeTok{type =} \StringTok{"pred"}\NormalTok{, }\AttributeTok{terms =} \FunctionTok{c}\NormalTok{(}\StringTok{"c12hour"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_light}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-16-2.pdf}

\hypertarget{regression-assumptions-and-diagnostics}{%
\subsection{Regression Assumptions and
Diagnostics}\label{regression-assumptions-and-diagnostics}}

\hypertarget{four-assumptions-of-regression}{%
\subsubsection{Four assumptions of
regression}\label{four-assumptions-of-regression}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  \emph{Linearity}: The relationship between \(X\) and the mean of \(Y\)
  is linear
\item
  \emph{Homoscedasticity}: The variance of the residual is the same for
  any value of \(X\)
\item
  \emph{Independence}: Observations are independent of each other
\item
  \emph{Normality}: For any fixed value of \(X\), \(Y\) is normally
  distributed \#\# Regression Diagnostics \#\#\# Residual Plots
  Residuals are the variance in \(Y\) that is unexplained by \(X\)
  \[\hat{e_i}=Y_i-\hat{Y_i}\]
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(Fertility }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Catholic }\SpecialCharTok{+}\NormalTok{ Agriculture }\SpecialCharTok{+}\NormalTok{ Education, }\AttributeTok{data =}\NormalTok{ swiss)}


\CommentTok{\# Residuals vs. X}
\CommentTok{\# Ideally want a "cloud" without a large amount of values at the extremes of X, we want it to look basically random}

\CommentTok{\# If we have a U{-}shape or an inverted U then that indicates the data may be better suited for a nonlinear model}

\CommentTok{\# We also want to check for any major outliers, is there a point that\textquotesingle{}s super far away from the rest?}
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{fit, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Agriculture, }\AttributeTok{y=}\NormalTok{.resid)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme\_light}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-17-1.pdf}

\hypertarget{leverages}{%
\subsubsection{Leverages}\label{leverages}}

Leverages tell us how much influence each value of \(X\) have

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(Fertility }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Catholic }\SpecialCharTok{+}\NormalTok{ Agriculture }\SpecialCharTok{+}\NormalTok{ Education, }\AttributeTok{data =}\NormalTok{ swiss)}

\FunctionTok{leveragePlot}\NormalTok{(}\AttributeTok{model=}\NormalTok{fit, }\AttributeTok{term.name=}\StringTok{"Catholic"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-18-1.pdf}

\begin{verbatim}
##  Rive Gauche   Neuveville Franches-Mnt   Porrentruy 
##           47            5            3            6
\end{verbatim}

\hypertarget{studentized-and-standardized-residuals}{%
\subsubsection{Studentized and Standardized
Residuals}\label{studentized-and-standardized-residuals}}

Standardized measurements of residuals, helps you see outliers.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(Fertility }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Catholic }\SpecialCharTok{+}\NormalTok{ Agriculture }\SpecialCharTok{+}\NormalTok{ Education, }\AttributeTok{data =}\NormalTok{ swiss)}

\CommentTok{\# Regular ole residuals}
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{fit, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{.fitted, }\AttributeTok{y=}\NormalTok{.resid)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme\_light}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-19-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Studentized residuals}
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{fit, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{.fitted, }\AttributeTok{y=}\FunctionTok{rstudent}\NormalTok{(fit))) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme\_light}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-19-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Standardized residuals}
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{fit, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{.fitted, }\AttributeTok{y=}\FunctionTok{rstandard}\NormalTok{(fit))) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme\_light}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-19-3.pdf}

\hypertarget{dfbeta}{%
\subsubsection{DFBETA}\label{dfbeta}}

Helps assess how influential each observation is. Essentially calculates
how much the slope changes when an observation is removed from the model

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(Fertility }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Catholic }\SpecialCharTok{+}\NormalTok{ Agriculture }\SpecialCharTok{+}\NormalTok{ Education, }\AttributeTok{data =}\NormalTok{ swiss)}

\FunctionTok{ols\_plot\_dfbetas}\NormalTok{(fit)}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-20-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# OR from car}

\FunctionTok{dfbetasPlots}\NormalTok{(fit)}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-20-2.pdf}

\hypertarget{cooks-distance}{%
\subsubsection{Cook's Distance}\label{cooks-distance}}

Tells you how far, on average, the predicted y-values will move if an
observation is dropped (note DFBeta is concerned with change in slope
but also shows you outliers)

Especially helpful for multivariate regression b/c combos of \(X\)s
could yield an influential point a residual plot won't catch.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(Fertility }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Catholic }\SpecialCharTok{+}\NormalTok{ Agriculture }\SpecialCharTok{+}\NormalTok{ Education, }\AttributeTok{data =}\NormalTok{ swiss)}

\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{fit, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Catholic, }\AttributeTok{y=}\FunctionTok{cooks.distance}\NormalTok{(fit))) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme\_light}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-21-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{fit, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Agriculture, }\AttributeTok{y=}\FunctionTok{cooks.distance}\NormalTok{(fit))) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme\_light}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-21-2.pdf}

\hypertarget{multicollinearity}{%
\subsubsection{Multicollinearity}\label{multicollinearity}}

The symptoms:

\begin{itemize}
\item
  Instability of estimates when adding or dropping variables
\item
  Massive coefficients or t-statistics
\item
  Two or more variables that are similar but with opposite signs
\end{itemize}

What do to:

\begin{itemize}
\item
  More data!
\item
  Simplify the model

  \begin{itemize}
  \item
    Do we need all the variables that are collinear?
  \item
    Could we combine two or more variables to create some sort of index?
  \end{itemize}
\end{itemize}

\hypertarget{instrumental-variables}{%
\subsection{Instrumental Variables}\label{instrumental-variables}}

A type of two-stage least squares regression (2SLS). Normally, when we
want to test whether \(X\) has some effect on \(Y\) we regress \(Y\) on
\(X\) (\(Y\sim X\) AKA \(Y=X\beta + \epsilon\)). However, when \(X\) is
correlated with the error term (i.e.~it is endogenous), \(\epsilon\),
OLS (and ANOVA) gives biased results. We get around this by using an
instrumental variable, \(Z\), which is \emph{uncorrelated} with
\(\epsilon\) and affects \(Y\) only through \(X\) (i.e.~is correlated
with \(X\) but not with \(\epsilon\)).

An example in \texttt{R}:

We want to estimate the relationship between the after-tax average price
of a pack of cigarettes (\(X\)) on the number of cigarette packs sold
per capita (\(Y\)). We can't estimate this relationship directly because
there is simultaneous causality between supply and demand. However, we
can use the sales tax per pack as an instrument (\(Z\)) as sales tax is
correlated with the after-tax price of a pack (\(X\)) and presumably
with the quantity of packs sold (\(Y\)) but only because sales tax
impacts the price per pack.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Example from: https://www.econometrics{-}with{-}r.org/12.1{-}TIVEWASRAASI.html}

\FunctionTok{data}\NormalTok{(}\StringTok{"CigarettesSW"}\NormalTok{)}

\CommentTok{\# Compute real per capita prices (X)}
\NormalTok{CigarettesSW}\SpecialCharTok{$}\NormalTok{rprice }\OtherTok{\textless{}{-}} \FunctionTok{with}\NormalTok{(CigarettesSW, price }\SpecialCharTok{/}\NormalTok{ cpi)}

\CommentTok{\# Compute the sales tax (Z)}
\NormalTok{CigarettesSW}\SpecialCharTok{$}\NormalTok{salestax }\OtherTok{\textless{}{-}} \FunctionTok{with}\NormalTok{(CigarettesSW, (taxs }\SpecialCharTok{{-}}\NormalTok{ tax) }\SpecialCharTok{/}\NormalTok{ cpi)}

\CommentTok{\# Check the correlation between Z and X}
\FunctionTok{cor}\NormalTok{(CigarettesSW}\SpecialCharTok{$}\NormalTok{salestax, CigarettesSW}\SpecialCharTok{$}\NormalTok{price)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.6141228
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Generate a subset for the year 1995}
\NormalTok{c1995 }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(CigarettesSW, year }\SpecialCharTok{==} \StringTok{"1995"}\NormalTok{)}

\CommentTok{\# Now we estimate the first stage X \textasciitilde{} Z}
\NormalTok{cig\_s1 }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(}\FunctionTok{log}\NormalTok{(rprice) }\SpecialCharTok{\textasciitilde{}}\NormalTok{ salestax, }\AttributeTok{data =}\NormalTok{ c1995)}

\FunctionTok{summary}\NormalTok{(cig\_s1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = log(rprice) ~ salestax, data = c1995)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -0.221027 -0.044324  0.000111  0.063730  0.210717 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept) 4.616546   0.029108   158.6  < 2e-16 ***
## salestax    0.030729   0.004802     6.4 7.27e-08 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.09394 on 46 degrees of freedom
## Multiple R-squared:  0.471,  Adjusted R-squared:  0.4595 
## F-statistic: 40.96 on 1 and 46 DF,  p-value: 7.271e-08
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Now get the predicted values from our first stage regression}
\NormalTok{lcigp\_pred }\OtherTok{\textless{}{-}}\NormalTok{ cig\_s1}\SpecialCharTok{$}\NormalTok{fitted.values}

\CommentTok{\# And regress our Y on our first stage fitted values}
\NormalTok{cig\_s2 }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(}\FunctionTok{log}\NormalTok{(c1995}\SpecialCharTok{$}\NormalTok{packs) }\SpecialCharTok{\textasciitilde{}}\NormalTok{ lcigp\_pred)}

\FunctionTok{summary}\NormalTok{(cig\_s2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = log(c1995$packs) ~ lcigp_pred)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.63180 -0.15802  0.00524  0.13574  0.61434 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)   9.7199     1.8012   5.396  2.3e-06 ***
## lcigp_pred   -1.0836     0.3766  -2.877  0.00607 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.2264 on 46 degrees of freedom
## Multiple R-squared:  0.1525, Adjusted R-squared:  0.1341 
## F-statistic: 8.277 on 1 and 46 DF,  p-value: 0.006069
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# }\AlertTok{NOTE}\CommentTok{: the AER package has a function that carries out 2SLS automatically}
\CommentTok{\# ivreg(Y \textasciitilde{} X | Z, data)}
\NormalTok{cig\_ivreg }\OtherTok{=} \FunctionTok{ivreg}\NormalTok{(}\FunctionTok{log}\NormalTok{(packs) }\SpecialCharTok{\textasciitilde{}} \FunctionTok{log}\NormalTok{(rprice) }\SpecialCharTok{|}\NormalTok{ salestax, }\AttributeTok{data =}\NormalTok{ c1995)}

\FunctionTok{summary}\NormalTok{(cig\_ivreg)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## ivreg(formula = log(packs) ~ log(rprice) | salestax, data = c1995)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.64619 -0.07732  0.02981  0.11283  0.41904 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)   9.7199     1.5141   6.420 6.79e-08 ***
## log(rprice)  -1.0836     0.3166  -3.422  0.00131 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.1904 on 46 degrees of freedom
## Multiple R-Squared: 0.4011,  Adjusted R-squared: 0.3881 
## Wald test: 11.71 on 1 and 46 DF,  p-value: 0.001313
\end{verbatim}

\hypertarget{poli-271}{%
\section{POLI 271}\label{poli-271}}

\hypertarget{likelihood-theory}{%
\subsection{Likelihood Theory}\label{likelihood-theory}}

\hypertarget{deriving-the-log-likelihood}{%
\subsubsection{Deriving the log
likelihood}\label{deriving-the-log-likelihood}}

Given some probability density function (our stochastic component),
\(f(y;\theta)\) (could be normal, Gaussian, etc.):

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Get the joint probability of the data. If the probabilities are
  independent then we have:
\end{enumerate}

\[Pr(y_i,. . ., y_n|\theta_1, . . ., \theta_n)=Pr(y;\theta)=\prod_{i=1}^nf(y_i;\theta_i)\]

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Convert the joint probability to a likelihood. Take the joint
  probability, multiply it by some constant scalar, \(h(y)\).
\end{enumerate}

\[\mathcal{L}(\theta|y)=h(y)\times Pr(y;\theta)\]

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\item
  Plug in our \(f(y;\theta)\) and simplify \(\mathcal{L}(\theta|y)\)
\item
  Simplify further by taking the log of \(\mathcal{L}(\theta|y)\)
\item
  Find the critical points by taking the first derivative w.r.t
  \(\theta\)
\item
  Check whether they are maxima or minima by taking the second
  derivative w.r.t. \(\theta\)
\end{enumerate}

An example:

The exponential probability density function is defined as:
\(f_e(x;\theta)=\theta e^{-\theta x}\).

First, note that since \(X~f_e(x;\theta)\) the support (possible values
of \(X\)) is \(\mathbb{R}\in [0, \infty]\)

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Get the joint probability
\end{enumerate}

\[f_{\mathrm{joint}}(x,\theta)=\prod_{i=1}^n(\theta e^{-\theta x_i})=\theta^n\prod_{i=1}^n( e^{-\theta x_i})\]

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Define the likelihood function
\end{enumerate}

\[\mathcal{L}(\theta|x)=h(x)\theta^n\prod_{i=1}^n( e^{-\theta x_i})\]

Let \(h(x)=1\)

\[\mathcal{L}(\theta|x)=\theta^n\prod_{i=1}^n( e^{-\theta x_i})\]

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Take the log
\end{enumerate}

\[\ln(\mathcal{L}(\theta|x))=\ln(\theta^n\prod_{i=1}^n( e^{-\theta x_i}))\]
\[\ln(\mathcal{L}(\theta|x))=n\ln(\theta)-\theta\sum_{i=1}^nx_i\]

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Take the first derivative and identify the critical points
\end{enumerate}

\[\frac{d\ln(\mathcal{L}(\theta|x))}{d\theta}=\frac{n}{\theta}-\sum_{i=1}^nx_i\]

Set the derivative equal to zero to find the critical values of
\(\theta\):

\[\frac{n}{\theta}-\sum_{i=1}^nx_i=0\]

\[\hat{\theta}=\frac{n}{\sum_{i=1}^nx_i}\]

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  Take the second derivative and substitute \(\hat{\theta}\) for
  \(\theta\). If the result is positive the critical point is a minumum,
  if zero then it's a saddle, if negative it's a maximum.
\end{enumerate}

\[\frac{d^2\ln(\mathcal{L}(\theta|x))}{d\theta^2}=\frac{-n}{\theta^2}\]

Plugging in \(\hat{\theta}\):

\[\frac{d^2ln(\mathcal{L}(\theta=\hat{\theta}|x))}{d\theta^2}=\frac{-n\sum_{i=1}^nx_i}{n}=-\sum_{i=1}^nx_i\]

What's the sign of \(-\sum_{i=1}^nx_i\)?

We know \(-\sum_{i=1}^nx_i<0\) because \(\sum_{i=1}^nx_i>0\) given the
\(X\) is bounded between \([0, \infty]\) therefore it is a maximum and
thus \(\hat{\theta}\) is a maximum and the MLE is
\(\hat{\theta}=\frac{n}{\sum_{i=1}^nx_i}\).

Now in R:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Sets the seed for R\textquotesingle{}s baked in random number generation for easy replication}
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{2}\NormalTok{)}

\CommentTok{\# Assigns x to be a vector of 1000 observations drawn from the exponential distribution}
\CommentTok{\# with lambda=3}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rexp}\NormalTok{(}\DecValTok{1000}\NormalTok{, }\DecValTok{3}\NormalTok{)}

\CommentTok{\# Returns the log likelihood for some parameter, theta, given data, x}
\NormalTok{exp.ll }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(theta, x)\{}\FunctionTok{return}\NormalTok{((}\FunctionTok{length}\NormalTok{(x)}\SpecialCharTok{*}\FunctionTok{log}\NormalTok{(theta))}\SpecialCharTok{{-}}\NormalTok{(theta}\SpecialCharTok{*}\FunctionTok{sum}\NormalTok{(x)))\}}

\NormalTok{thetas }\OtherTok{=} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{25}\NormalTok{,}\FloatTok{0.1}\NormalTok{)}

\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}

\ControlFlowTok{for}\NormalTok{(theta }\ControlFlowTok{in}\NormalTok{ thetas)\{}
\NormalTok{  y }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(y,}\FunctionTok{exp.ll}\NormalTok{(}\AttributeTok{theta=}\NormalTok{theta,}\AttributeTok{x=}\NormalTok{x))}
\NormalTok{\}}

\NormalTok{theta\_hat }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(x)}\SpecialCharTok{/}\FunctionTok{sum}\NormalTok{(x)}
\FunctionTok{paste}\NormalTok{(}\StringTok{"For the given x, theta\_hat is: "}\NormalTok{, theta\_hat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "For the given x, theta_hat is:  2.8956932819183"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(y,thetas)}

\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{df,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{thetas,}\AttributeTok{y=}\NormalTok{y)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size=}\FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept=}\NormalTok{theta\_hat, }\AttributeTok{color=}\StringTok{"red"}\NormalTok{, }\AttributeTok{linetype=}\StringTok{"dashed"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Log likelihood vs. theta"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"theta"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Log likelihood"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-23-1.pdf}

Note: See MLE Problem Set 2 for a derivation of the MLE of the normal
variance.

\hypertarget{regularity}{%
\subsection{Regularity}\label{regularity}}

In order to find the MLE as we did above, the likelihood function must
demonstrate ``regularity'', i.e.~it must be continuous and twice
differentiable.

\hypertarget{binary-data}{%
\subsection{Binary Data}\label{binary-data}}

\hypertarget{why-not-just-use-ols}{%
\subsubsection{Why not just use OLS?}\label{why-not-just-use-ols}}

\begin{itemize}
\tightlist
\item
  Nonsensical predictions: predicted probabilites using a linear
  probability model on a binary outcome can fall outside \([0,1]\),
  meaning the OLS estimate is biased and inconsistent.
\item
  Assumes the relationship between a covariate and the probability of 1
  as the outcome is constant across all values of the covariate
\item
  Can give you heteroskedastic residuals that give biased confidence
  intervals
\end{itemize}

\hypertarget{the-logit-model}{%
\subsubsection{The Logit Model}\label{the-logit-model}}

Logit allows for mapping probabilities onto the unbounded real line
using odds. We transform a probability, \(p\), to logit by taking the
log of the odds ratio:

\[\mathrm{logit}(p)=\log(\frac{p}{1-p})\]

And the inverse mapping:\\

\[
\mathrm{logit}^{-1}(x)=\frac{e^x}{1+e^x}=\frac{1}{1+e^{-x}}
\]

We model binary outcomes as Bernoulli trials so our stochastic component
is:

\[
f_B(y_i;\theta_i)=\theta_i^{y_i}(1-\theta_i)^{1-y_i}= 
   \left\{
\begin{array}{ll}
      \theta_i & y_i=1 \\
      1-\theta_i & y_i=0
\end{array} 
\right. 
\]

And our systematic component is:

\[
\theta_i=\mathrm{logit}^{-1}(x_i^T\beta)=\frac{1}{1+e^{-x_i^T\beta}}
\]

As we do above we can then get the joint probability distribution:

\[
Pr(y|\theta)=\prod_{i=1}^n \theta_i^{y_i}(1-\theta_i)^{1-y_i}
\]

And the log-likelihood:

\[
\log\mathcal{L}(\theta|y)=\sum_{i=1}^n\log(\frac{e^{-x_i^T\beta^{1-y_i}}}{1+e^{-x_i^T\beta}})
\]

Finding the MLE with R (Ward and Ahlquist code):

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#function for optimization of logit}
\NormalTok{binreg}\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(X,y,}\AttributeTok{method=}\StringTok{"BFGS"}\NormalTok{)\{}
\NormalTok{  X}\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(}\DecValTok{1}\NormalTok{,X)}
  
  \CommentTok{\# Get the log{-}likelihood}
\NormalTok{  negLL}\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(b,X,y)\{}
\NormalTok{    p}\OtherTok{\textless{}{-}}\FunctionTok{as.vector}\NormalTok{(}\DecValTok{1}\SpecialCharTok{/}\NormalTok{(}\DecValTok{1}\SpecialCharTok{+}\FunctionTok{exp}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{X }\SpecialCharTok{\%*\%}\NormalTok{ b)))}
    
    \FunctionTok{return}\NormalTok{(}\SpecialCharTok{{-}}\FunctionTok{sum}\NormalTok{(y}\SpecialCharTok{*}\FunctionTok{log}\NormalTok{(p) }\SpecialCharTok{+}\NormalTok{ (}\DecValTok{1}\SpecialCharTok{{-}}\NormalTok{y)}\SpecialCharTok{*}\FunctionTok{log}\NormalTok{(}\DecValTok{1}\SpecialCharTok{{-}}\NormalTok{p)))}
\NormalTok{  \}}
  
  \CommentTok{\# Get the gradient}
\NormalTok{  gradient}\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(b,X,y)\{}
\NormalTok{    p }\OtherTok{\textless{}{-}} \FunctionTok{as.vector}\NormalTok{(}\DecValTok{1}\SpecialCharTok{/}\NormalTok{(}\DecValTok{1}\SpecialCharTok{+}\FunctionTok{exp}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{X }\SpecialCharTok{\%*\%}\NormalTok{ b)))}
    
    \FunctionTok{return}\NormalTok{(}\SpecialCharTok{{-}}\FunctionTok{apply}\NormalTok{(((y }\SpecialCharTok{{-}}\NormalTok{ p)}\SpecialCharTok{*}\NormalTok{X), }\DecValTok{2}\NormalTok{, sum))}
\NormalTok{  \}}
  
  \CommentTok{\# Pass our data, log{-}likelihood, and gradient to optim() }
  \CommentTok{\# which will find the maximum likelihood}
\NormalTok{  results}\OtherTok{\textless{}{-}} \FunctionTok{optim}\NormalTok{(}\AttributeTok{par=}\FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{,}\FunctionTok{ncol}\NormalTok{(X)), }
                  \AttributeTok{fn=}\NormalTok{negLL,}
                  \AttributeTok{gr=}\NormalTok{gradient, }
                  \AttributeTok{hessian=}\NormalTok{T, }
                  \AttributeTok{method=}\NormalTok{method,}
                  \AttributeTok{X=}\NormalTok{X,}
                  \AttributeTok{y=}\NormalTok{y)}
  
  \CommentTok{\# Pull out the stuff we want}
  \FunctionTok{list}\NormalTok{(}\AttributeTok{coefficients=}\NormalTok{results}\SpecialCharTok{$}\NormalTok{par,}
       \AttributeTok{var=}\FunctionTok{solve}\NormalTok{(results}\SpecialCharTok{$}\NormalTok{hessian),}
       \AttributeTok{deviance=}\DecValTok{2}\SpecialCharTok{*}\NormalTok{results}\SpecialCharTok{$}\NormalTok{value,}
       \AttributeTok{converged=}\NormalTok{results}\SpecialCharTok{$}\NormalTok{convergence}\SpecialCharTok{==}\DecValTok{0}\NormalTok{)}
\NormalTok{\}}

\FunctionTok{data}\NormalTok{(}\StringTok{"mtcars"}\NormalTok{)}

\CommentTok{\# set the DV to the binary variable for V{-}shaped vs. straight engine type}
\NormalTok{DV }\OtherTok{\textless{}{-}}\NormalTok{ mtcars}\SpecialCharTok{$}\NormalTok{vs}

\NormalTok{IVs }\OtherTok{\textless{}{-}} \FunctionTok{as.matrix}\NormalTok{(mtcars }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(cyl, disp, hp))}

\NormalTok{mlebin.fit}\OtherTok{\textless{}{-}}\FunctionTok{binreg}\NormalTok{(}\AttributeTok{X=}\NormalTok{IVs, }\AttributeTok{y=}\NormalTok{DV)}

\CommentTok{\# Get our logit coefficients}
\FunctionTok{round}\NormalTok{(mlebin.fit}\SpecialCharTok{$}\NormalTok{coefficients,}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10.07 -1.08  0.01 -0.04
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Compare to R\textquotesingle{}s baked in logit estimation}
\NormalTok{fit.glm }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(vs }\SpecialCharTok{\textasciitilde{}}\NormalTok{ cyl }\SpecialCharTok{+}\NormalTok{ disp }\SpecialCharTok{+}\NormalTok{ hp,}
               \AttributeTok{family =} \FunctionTok{binomial}\NormalTok{(}\AttributeTok{link =} \StringTok{"logit"}\NormalTok{), }
               \AttributeTok{data =}\NormalTok{ mtcars)}
\FunctionTok{summary}\NormalTok{(fit.glm, }\AttributeTok{signif.stars=}\ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## glm(formula = vs ~ cyl + disp + hp, family = binomial(link = "logit"), 
##     data = mtcars)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.37997  -0.23996  -0.04823   0.35762   1.34781  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(>|z|)  
## (Intercept) 10.069083   3.917828   2.570   0.0102 *
## cyl         -1.075480   1.079346  -0.996   0.3190  
## disp         0.008179   0.015662   0.522   0.6015  
## hp          -0.043732   0.037350  -1.171   0.2417  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 43.860  on 31  degrees of freedom
## Residual deviance: 15.758  on 28  degrees of freedom
## AIC: 23.758
## 
## Number of Fisher Scoring iterations: 7
\end{verbatim}

\hypertarget{interpreting-logit}{%
\subsubsection{Interpreting Logit}\label{interpreting-logit}}

While the output of logit is similar to OLS, interpretation is a bit
more nuanced for 2 reasons:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  The model is nonlinear so the effect of a particular covariate on the
  DV is not constant across all levels of the covariate. This can be
  seen by deriving the marginal effect of a covariate, \(x_k\), on the
  expected value of \(Y\):
\end{enumerate}

\[\frac{\partial E[Y_i]}{\partial x_{ki}}=\frac{\partial\theta_i}{\partial x_{ki}}=\beta_k\frac{e^{x_i^T\beta}}{(1+e^{x_i^T\beta})^2}\]

As a quick trick, you can divide a coefficient by 4 to get an estimate
of a maximum effect a 1 unit increase in the covariate can have on the
probability of the DV being 1. i.e.~if we have a coefficent of -1.45
then \(\frac{-1.45}{4}=-0.4\) so a 1 unit increase in the IV reduces the
probability of the DV being one by about 40\%.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  The logit model is a linear regression on the log odds so the
  exponentiated coefficients are odds ratios. If we have a coefficient
  greater than 1 then a 1 unit increase in that covariate corresponds to
  an \emph{increase} in the relative probability of obtaining a 1 in the
  outcome variable. Less than 1 represents a decrease.
\end{enumerate}

\hypertarget{interpreting-logit-with-plots}{%
\subsubsection{Interpreting Logit with
Plots}\label{interpreting-logit-with-plots}}

We can use a coefficient plot to avoid a BUTON

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Read in and clean up the data}
\NormalTok{impeach }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"Data/impeach.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 435 Columns: 5
\end{verbatim}

\begin{verbatim}
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## dbl (5): votesum, clint96, partyid, aflcio97, ccoal98
\end{verbatim}

\begin{verbatim}
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#impeach \textless{}{-} impeach \%\textgreater{}\% select({-}ccoal98)}
\NormalTok{impeach }\OtherTok{\textless{}{-}} \FunctionTok{na.omit}\NormalTok{(impeach)}
\FunctionTok{attach}\NormalTok{(impeach)}

\CommentTok{\# Make our DV binary}
\NormalTok{impeach}\SpecialCharTok{$}\NormalTok{votebin[votesum }\SpecialCharTok{!=} \DecValTok{0}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Unknown or uninitialised column: `votebin`.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{impeach}\SpecialCharTok{$}\NormalTok{votebin[votesum }\SpecialCharTok{==} \DecValTok{0}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{0}

\CommentTok{\# Estimate the model}
\NormalTok{model }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(votebin }\SpecialCharTok{\textasciitilde{}}\NormalTok{ partyid }\SpecialCharTok{+}\NormalTok{ clint96, }\AttributeTok{family=}\FunctionTok{binomial}\NormalTok{(}\AttributeTok{link=}\StringTok{"logit"}\NormalTok{), }\AttributeTok{data=}\NormalTok{impeach)}

\FunctionTok{summary}\NormalTok{(model)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## glm(formula = votebin ~ partyid + clint96, family = binomial(link = "logit"), 
##     data = impeach)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -3.2606  -0.0414   0.0128   0.0848   2.5753  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(>|z|)    
## (Intercept) 11.22019    3.25291   3.449 0.000562 ***
## partyid      7.95961    1.03158   7.716 1.20e-14 ***
## clint96     -0.31520    0.07542  -4.179 2.92e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 593.487  on 428  degrees of freedom
## Residual deviance:  57.753  on 426  degrees of freedom
## AIC: 63.753
## 
## Number of Fisher Scoring iterations: 9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Tidy the model}
\NormalTok{results }\OtherTok{\textless{}{-}} \FunctionTok{tidy}\NormalTok{(model)}

\CommentTok{\# Get the 95\% CI}
\NormalTok{fit\_cis\_95 }\OtherTok{\textless{}{-}} \FunctionTok{confint}\NormalTok{(model, }\AttributeTok{level =} \FloatTok{0.95}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{data.frame}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\StringTok{"conf.low\_95"} \OtherTok{=} \StringTok{"X2.5.."}\NormalTok{,}
         \StringTok{"conf.high\_95"} \OtherTok{=} \StringTok{"X97.5.."}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Waiting for profiling to be done...
\end{verbatim}

\begin{verbatim}
## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Get the 90\% CI}
\NormalTok{fit\_cis\_90 }\OtherTok{\textless{}{-}} \FunctionTok{confint}\NormalTok{(model, }\AttributeTok{level =} \FloatTok{0.90}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{data.frame}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\StringTok{"conf.low\_90"} \OtherTok{=} \StringTok{"X5.."}\NormalTok{,}
         \StringTok{"conf.high\_90"} \OtherTok{=} \StringTok{"X95.."}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Waiting for profiling to be done...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Bind it together}
\NormalTok{results }\OtherTok{\textless{}{-}} \FunctionTok{bind\_cols}\NormalTok{(results, }
\NormalTok{                     fit\_cis\_95, }
\NormalTok{                     fit\_cis\_90) }\SpecialCharTok{\%\textgreater{}\%}
           \FunctionTok{rename}\NormalTok{(}\AttributeTok{Variable =}\NormalTok{ term,}
                  \AttributeTok{Coefficient =}\NormalTok{ estimate,}
                  \AttributeTok{SE =}\NormalTok{ std.error) }\SpecialCharTok{\%\textgreater{}\%}
           \FunctionTok{filter}\NormalTok{(Variable }\SpecialCharTok{!=} \StringTok{"(Intercept)"}\NormalTok{)}

\CommentTok{\# Plot it!}
\FunctionTok{ggplot}\NormalTok{(results, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Variable, }\AttributeTok{y =}\NormalTok{ Coefficient)) }\SpecialCharTok{+}
        \FunctionTok{geom\_hline}\NormalTok{(}\AttributeTok{yintercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{color =} \StringTok{"red"}\NormalTok{, }\AttributeTok{lty =} \DecValTok{2}\NormalTok{) }\SpecialCharTok{+}
        \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Variable, }
                    \AttributeTok{y =}\NormalTok{ Coefficient)) }\SpecialCharTok{+} 
        \CommentTok{\# geom\_linerange(aes(x = Variable, }
        \CommentTok{\#              ymin = conf.low\_90,}
        \CommentTok{\#              ymax = conf.high\_90),}
        \CommentTok{\#            lwd = 1) +}
        \FunctionTok{geom\_errorbar}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Variable, }
                     \AttributeTok{ymin =}\NormalTok{ conf.low\_95,}
                     \AttributeTok{ymax =}\NormalTok{ conf.high\_95),}
                     \AttributeTok{width=}\NormalTok{.}\DecValTok{1}\NormalTok{) }\SpecialCharTok{+} 
        \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Coefficient Plot"}\NormalTok{) }\SpecialCharTok{+}
        \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme\_light}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-25-1.pdf}

We can use a predicted probability plot to show the substantive impact
of our results

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Say we want to know the difference in predicted probability}
\CommentTok{\# of a Republican vs. a Democrat voting to impeach Clinton}

\CommentTok{\# Create a sequence of the range of values for the 96 vote share}
\NormalTok{clint96.range }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\FunctionTok{min}\NormalTok{(impeach}\SpecialCharTok{$}\NormalTok{clint96),}\FunctionTok{max}\NormalTok{(impeach}\SpecialCharTok{$}\NormalTok{clint96),.}\DecValTok{1}\NormalTok{)}

\CommentTok{\# Construct the Democratic scenario}
\NormalTok{x.lo }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{, }\FunctionTok{median}\NormalTok{(impeach}\SpecialCharTok{$}\NormalTok{clint96)) }\CommentTok{\# Democrat scenario}
\NormalTok{X.lo }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(x.lo, }\AttributeTok{nrow=}\FunctionTok{length}\NormalTok{(x.lo), }\AttributeTok{ncol=}\FunctionTok{length}\NormalTok{(clint96.range))}
\NormalTok{X.lo[}\DecValTok{3}\NormalTok{,] }\OtherTok{\textless{}{-}}\NormalTok{ clint96.range}

\CommentTok{\# Construct the Republican scenario}
\NormalTok{x.hi }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FunctionTok{median}\NormalTok{(impeach}\SpecialCharTok{$}\NormalTok{clint96)) }\CommentTok{\# Republican scenario}
\NormalTok{X.hi }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(x.hi, }\AttributeTok{nrow=}\FunctionTok{length}\NormalTok{(x.hi), }\AttributeTok{ncol=}\FunctionTok{length}\NormalTok{(clint96.range))}
\NormalTok{X.hi[}\DecValTok{3}\NormalTok{,] }\OtherTok{\textless{}{-}}\NormalTok{ clint96.range}

\CommentTok{\# Generate a multivariate normal distribution}
\NormalTok{B.tilde }\OtherTok{\textless{}{-}} \FunctionTok{mvrnorm}\NormalTok{(}\DecValTok{1000}\NormalTok{, }\FunctionTok{coef}\NormalTok{(model), }\FunctionTok{vcov}\NormalTok{(model))}

\CommentTok{\# Generate the predicted probabilities}
\NormalTok{s.lo }\OtherTok{\textless{}{-}} \FunctionTok{inv.logit}\NormalTok{(B.tilde }\SpecialCharTok{\%*\%}\NormalTok{ X.lo)}
\NormalTok{s.hi }\OtherTok{\textless{}{-}} \FunctionTok{inv.logit}\NormalTok{(B.tilde }\SpecialCharTok{\%*\%}\NormalTok{ X.hi)}
\NormalTok{s.lo }\OtherTok{\textless{}{-}} \FunctionTok{apply}\NormalTok{(s.lo, }\DecValTok{2}\NormalTok{, quantile, }\FunctionTok{c}\NormalTok{(}\FloatTok{0.025}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\FloatTok{0.975}\NormalTok{))}
\NormalTok{s.hi }\OtherTok{\textless{}{-}} \FunctionTok{apply}\NormalTok{(s.hi, }\DecValTok{2}\NormalTok{, quantile, }\FunctionTok{c}\NormalTok{(}\FloatTok{0.025}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\FloatTok{0.975}\NormalTok{))}


\CommentTok{\# Now tidy the data and plot with ggplot}
\NormalTok{pred.prob.df }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{xrange=}\FunctionTok{rep}\NormalTok{(clint96.range,}\DecValTok{2}\NormalTok{), }
                           \AttributeTok{y=}\FunctionTok{c}\NormalTok{(s.lo[}\DecValTok{2}\NormalTok{,],s.hi[}\DecValTok{2}\NormalTok{,]),}
                           \AttributeTok{conf.low =} \FunctionTok{c}\NormalTok{(s.lo[}\DecValTok{1}\NormalTok{,], s.hi[}\DecValTok{1}\NormalTok{,]),}
                           \AttributeTok{conf.high =} \FunctionTok{c}\NormalTok{(s.lo[}\DecValTok{3}\NormalTok{,], s.hi[}\DecValTok{3}\NormalTok{,]),}
                           \AttributeTok{scenario =} \FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"Democrat"}\NormalTok{, }\StringTok{"Republican"}\NormalTok{), }
                                          \AttributeTok{each=}\FunctionTok{length}\NormalTok{(clint96.range)))}

\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{pred.prob.df, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{xrange, }\AttributeTok{y=}\NormalTok{y,}
                              \AttributeTok{ymin=}\NormalTok{conf.low,}
                              \AttributeTok{ymax=}\NormalTok{conf.high,}
                              \AttributeTok{fill=}\FunctionTok{factor}\NormalTok{(scenario),}
                              \AttributeTok{linetype=}\FunctionTok{factor}\NormalTok{(scenario))) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{size=}\NormalTok{.}\DecValTok{8}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_ribbon}\NormalTok{(}\AttributeTok{alpha=}\FloatTok{0.25}\NormalTok{, }\AttributeTok{color=}\StringTok{"gray"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x=}\StringTok{"1996 Vote Share for Clinton"}\NormalTok{, }\AttributeTok{y=}\StringTok{"Predicted Probability"}\NormalTok{,}
       \AttributeTok{title=}\StringTok{"Predicted Probability Plot"}\NormalTok{, }\AttributeTok{linetype=}\StringTok{"Scenario"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{labels=}\FunctionTok{c}\NormalTok{(}\StringTok{"Democrat"}\NormalTok{, }\StringTok{"Republican"}\NormalTok{), }
                    \AttributeTok{values=}\FunctionTok{c}\NormalTok{(}\StringTok{"blue"}\NormalTok{, }\StringTok{"red"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{guides}\NormalTok{(}\AttributeTok{fill=}\StringTok{"none"}\NormalTok{, }\AttributeTok{color=}\StringTok{"none"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-26-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Or use base graphics (ew)}

\CommentTok{\#jpeg(file="pred\_prob.jpeg")}

\CommentTok{\# Get our blank plot}
\FunctionTok{plot}\NormalTok{(clint96.range, s.lo[}\DecValTok{2}\NormalTok{,], }\AttributeTok{ylim=}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{),}
     \AttributeTok{xlab=}\StringTok{"Clinton 1996 District Vote Share"}\NormalTok{,}
     \AttributeTok{ylab=}\StringTok{"Predicted Probability of Voting for Impeachment"}\NormalTok{,}
     \AttributeTok{main=}\StringTok{"Impeachment Vote, Party ID, and 1996 Clinton Vote Share"}\NormalTok{,}
     \AttributeTok{bty=}\StringTok{"n"}\NormalTok{, }\AttributeTok{col=}\StringTok{"white"}\NormalTok{)}

\CommentTok{\# Plot the confidence bands}
\FunctionTok{polygon}\NormalTok{(}\AttributeTok{x=}\FunctionTok{c}\NormalTok{(clint96.range, }\FunctionTok{rev}\NormalTok{(clint96.range)),}
        \AttributeTok{y=}\FunctionTok{c}\NormalTok{(s.lo[}\DecValTok{1}\NormalTok{,],}\FunctionTok{rev}\NormalTok{(s.lo[}\DecValTok{3}\NormalTok{,])),}
        \AttributeTok{col=}\FunctionTok{grey}\NormalTok{(}\FloatTok{0.8}\NormalTok{), }\AttributeTok{border=}\ConstantTok{NA}\NormalTok{)}

\FunctionTok{polygon}\NormalTok{(}\AttributeTok{x=}\FunctionTok{c}\NormalTok{(clint96.range, }\FunctionTok{rev}\NormalTok{(clint96.range)),}
        \AttributeTok{y=}\FunctionTok{c}\NormalTok{(s.hi[}\DecValTok{1}\NormalTok{,],}\FunctionTok{rev}\NormalTok{(s.hi[}\DecValTok{3}\NormalTok{,])),}
        \AttributeTok{col=}\FunctionTok{grey}\NormalTok{(}\FloatTok{0.8}\NormalTok{), }\AttributeTok{border=}\ConstantTok{NA}\NormalTok{)}

\CommentTok{\#Plot the predicted probability curves}
\FunctionTok{lines}\NormalTok{(clint96.range, s.hi[}\DecValTok{2}\NormalTok{,], }\AttributeTok{lty=}\DecValTok{3}\NormalTok{, }\AttributeTok{lwd=}\DecValTok{2}\NormalTok{)}

\FunctionTok{lines}\NormalTok{(clint96.range, s.lo[}\DecValTok{2}\NormalTok{,], }\AttributeTok{lwd=}\DecValTok{2}\NormalTok{)}

\FunctionTok{legend}\NormalTok{(}\DecValTok{70}\NormalTok{, }\DecValTok{1}\NormalTok{, }\AttributeTok{legend=}\FunctionTok{c}\NormalTok{(}\StringTok{"Democrat"}\NormalTok{, }\StringTok{"Republican"}\NormalTok{), }\AttributeTok{lty=}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{),}\AttributeTok{lwd=}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-26-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#dev.off()}
\end{Highlighting}
\end{Shaded}

We can also use a predicted probability plot to model an interaction in
a logit model

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Load in the data}
\NormalTok{impeach }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"Data/impeach.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 435 Columns: 5
\end{verbatim}

\begin{verbatim}
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## dbl (5): votesum, clint96, partyid, aflcio97, ccoal98
\end{verbatim}

\begin{verbatim}
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{impeach }\OtherTok{\textless{}{-}}\NormalTok{ impeach }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{na.omit}\NormalTok{()}

\NormalTok{impeach}\SpecialCharTok{$}\NormalTok{votebin[impeach}\SpecialCharTok{$}\NormalTok{votesum }\SpecialCharTok{!=} \DecValTok{0}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Unknown or uninitialised column: `votebin`.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{impeach}\SpecialCharTok{$}\NormalTok{votebin[impeach}\SpecialCharTok{$}\NormalTok{votesum }\SpecialCharTok{==} \DecValTok{0}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{0}

\NormalTok{model\_int }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(votebin }\SpecialCharTok{\textasciitilde{}}\NormalTok{ clint96 }\SpecialCharTok{*}\NormalTok{ aflcio97 ,}\AttributeTok{family=}\FunctionTok{binomial}\NormalTok{(}\AttributeTok{link=}\StringTok{"logit"}\NormalTok{),}
                 \AttributeTok{data=}\NormalTok{impeach)}
\NormalTok{model\_noint }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(votebin }\SpecialCharTok{\textasciitilde{}}\NormalTok{ clint96 }\SpecialCharTok{+}\NormalTok{ aflcio97,}
                   \AttributeTok{family=}\FunctionTok{binomial}\NormalTok{(}\AttributeTok{link=}\StringTok{"logit"}\NormalTok{),}
                   \AttributeTok{data=}\NormalTok{impeach)}

\FunctionTok{modelsummary}\NormalTok{(}\FunctionTok{list}\NormalTok{(model\_noint, model\_int), }\AttributeTok{title=}\StringTok{"Impeachment models"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:unnamed-chunk-27}Impeachment models}
\centering
\begin{tabular}[t]{lcc}
\toprule
  & Model 1 & Model 2\\
\midrule
(Intercept) & \num{10.344} & \num{14.946}\\
 & (\num{2.969}) & (\num{9.954})\\
clint96 & \num{-0.060} & \num{-0.152}\\
 & (\num{0.059}) & (\num{0.197})\\
aflcio97 & \num{-0.122} & \num{-0.182}\\
 & (\num{0.016}) & (\num{0.122})\\
clint96 × aflcio97 &  & \num{0.001}\\
 &  & (\num{0.002})\\
\midrule
Num.Obs. & \num{429} & \num{429}\\
AIC & \num{83.3} & \num{85.0}\\
BIC & \num{95.5} & \num{101.3}\\
Log.Lik. & \num{-38.648} & \num{-38.517}\\
\bottomrule
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{clint96.range }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\FunctionTok{quantile}\NormalTok{(impeach}\SpecialCharTok{$}\NormalTok{clint96)[}\DecValTok{2}\NormalTok{],}
                    \FunctionTok{quantile}\NormalTok{(impeach}\SpecialCharTok{$}\NormalTok{clint96)[}\DecValTok{4}\NormalTok{],.}\DecValTok{1}\NormalTok{)}

\CommentTok{\# NO INTERACTION MODEL}
\NormalTok{x.lo }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{median}\NormalTok{(impeach}\SpecialCharTok{$}\NormalTok{clint96), }\DecValTok{0}\NormalTok{) }\CommentTok{\# Q1 clint96 scenario}
\NormalTok{X.lo }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(x.lo, }\AttributeTok{nrow=}\FunctionTok{length}\NormalTok{(x.lo), }\AttributeTok{ncol=}\FunctionTok{length}\NormalTok{(clint96.range))}
\NormalTok{X.lo[}\DecValTok{2}\NormalTok{,] }\OtherTok{\textless{}{-}}\NormalTok{ clint96.range}

\NormalTok{x.hi }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{median}\NormalTok{(impeach}\SpecialCharTok{$}\NormalTok{clint96), }\DecValTok{100}\NormalTok{) }\CommentTok{\# Q2 clint96 scenario}
\NormalTok{X.hi }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(x.hi, }\AttributeTok{nrow=}\FunctionTok{length}\NormalTok{(x.hi), }\AttributeTok{ncol=}\FunctionTok{length}\NormalTok{(clint96.range))}
\NormalTok{X.hi[}\DecValTok{2}\NormalTok{,] }\OtherTok{\textless{}{-}}\NormalTok{ clint96.range}

\NormalTok{B.tilde }\OtherTok{\textless{}{-}} \FunctionTok{mvrnorm}\NormalTok{(}\DecValTok{1000}\NormalTok{, }\FunctionTok{coef}\NormalTok{(model\_noint), }\FunctionTok{vcov}\NormalTok{(model\_noint))}

\NormalTok{s.lo }\OtherTok{\textless{}{-}} \FunctionTok{inv.logit}\NormalTok{(B.tilde }\SpecialCharTok{\%*\%}\NormalTok{ X.lo) }\CommentTok{\# Note we would use pnorm() here instead if }
\NormalTok{s.hi }\OtherTok{\textless{}{-}} \FunctionTok{inv.logit}\NormalTok{(B.tilde }\SpecialCharTok{\%*\%}\NormalTok{ X.hi) }\CommentTok{\# evaluating a probit model!}

\NormalTok{s.lo }\OtherTok{\textless{}{-}} \FunctionTok{apply}\NormalTok{(s.lo, }\DecValTok{2}\NormalTok{, quantile, }\FunctionTok{c}\NormalTok{(}\FloatTok{0.025}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\FloatTok{0.975}\NormalTok{))}
\NormalTok{s.hi }\OtherTok{\textless{}{-}} \FunctionTok{apply}\NormalTok{(s.hi, }\DecValTok{2}\NormalTok{, quantile, }\FunctionTok{c}\NormalTok{(}\FloatTok{0.025}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\FloatTok{0.975}\NormalTok{))}


\CommentTok{\# Now tidy the data and plot with ggplot}
\NormalTok{pred.prob.df.noint }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{xrange=}\FunctionTok{rep}\NormalTok{(clint96.range,}\DecValTok{2}\NormalTok{), }
                           \AttributeTok{y=}\FunctionTok{c}\NormalTok{(s.lo[}\DecValTok{2}\NormalTok{,],s.hi[}\DecValTok{2}\NormalTok{,]),}
                           \AttributeTok{conf.low =} \FunctionTok{c}\NormalTok{(s.lo[}\DecValTok{1}\NormalTok{,], s.hi[}\DecValTok{1}\NormalTok{,]),}
                           \AttributeTok{conf.high =} \FunctionTok{c}\NormalTok{(s.lo[}\DecValTok{3}\NormalTok{,], s.hi[}\DecValTok{3}\NormalTok{,]),}
                           \AttributeTok{scenario =} \FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"AFL{-}CIO=100"}\NormalTok{, }\StringTok{"AFL{-}CIO=0"}\NormalTok{), }
                                          \AttributeTok{each=}\FunctionTok{length}\NormalTok{(clint96.range)))}

\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{pred.prob.df.noint, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{xrange, }\AttributeTok{y=}\NormalTok{y,}
                              \AttributeTok{ymin=}\NormalTok{conf.low,}
                              \AttributeTok{ymax=}\NormalTok{conf.high,}
                              \AttributeTok{fill=}\FunctionTok{factor}\NormalTok{(scenario),}
                              \AttributeTok{linetype=}\FunctionTok{factor}\NormalTok{(scenario))) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{size=}\NormalTok{.}\DecValTok{8}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_ribbon}\NormalTok{(}\AttributeTok{alpha=}\FloatTok{0.25}\NormalTok{, }\AttributeTok{color=}\StringTok{"gray"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x=}\StringTok{"1996 Vote Share for Clinton"}\NormalTok{, }\AttributeTok{y=}\StringTok{"Predicted Probability"}\NormalTok{,}
       \AttributeTok{title=}\StringTok{"Predicted Probability Plot for No Interaction Model"}\NormalTok{, }\AttributeTok{linetype=}\StringTok{"Scenario"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{labels=}\FunctionTok{c}\NormalTok{(}\StringTok{"AFL{-}CIO=100"}\NormalTok{, }\StringTok{"AFL{-}CIO=0"}\NormalTok{), }
                    \AttributeTok{values=}\FunctionTok{c}\NormalTok{(}\StringTok{"blue"}\NormalTok{, }\StringTok{"red"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{guides}\NormalTok{(}\AttributeTok{fill=}\StringTok{"none"}\NormalTok{, }\AttributeTok{color=}\StringTok{"none"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-28-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# INTERACTION MODEL}
\NormalTok{x.lo }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{median}\NormalTok{(impeach}\SpecialCharTok{$}\NormalTok{clint96)[}\DecValTok{2}\NormalTok{], }\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{) }\CommentTok{\# 0 AFL{-}CIO score scenario}
\NormalTok{X.lo }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(x.lo, }\AttributeTok{nrow=}\FunctionTok{length}\NormalTok{(x.lo), }\AttributeTok{ncol=}\FunctionTok{length}\NormalTok{(clint96.range))}
\NormalTok{X.lo[}\DecValTok{2}\NormalTok{,] }\OtherTok{\textless{}{-}}\NormalTok{ clint96.range}
\NormalTok{X.lo[}\DecValTok{4}\NormalTok{,] }\OtherTok{\textless{}{-}}\NormalTok{ clint96.range}\SpecialCharTok{*}\DecValTok{0}

\NormalTok{x.hi }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{quantile}\NormalTok{(impeach}\SpecialCharTok{$}\NormalTok{clint96)[}\DecValTok{4}\NormalTok{], }\DecValTok{100}\NormalTok{, }\DecValTok{0}\NormalTok{) }\CommentTok{\# 100 AFL{-}CIO score scenario}
\NormalTok{X.hi }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(x.hi, }\AttributeTok{nrow=}\FunctionTok{length}\NormalTok{(x.hi), }\AttributeTok{ncol=}\FunctionTok{length}\NormalTok{(clint96.range))}
\NormalTok{X.hi[}\DecValTok{2}\NormalTok{,] }\OtherTok{\textless{}{-}}\NormalTok{ clint96.range}
\NormalTok{X.hi[}\DecValTok{4}\NormalTok{,] }\OtherTok{\textless{}{-}}\NormalTok{ clint96.range}\SpecialCharTok{*}\DecValTok{100}

\NormalTok{B.tilde }\OtherTok{\textless{}{-}} \FunctionTok{mvrnorm}\NormalTok{(}\DecValTok{1000}\NormalTok{, }\FunctionTok{coef}\NormalTok{(model\_int), }\FunctionTok{vcov}\NormalTok{(model\_int))}

\NormalTok{s.lo }\OtherTok{\textless{}{-}} \FunctionTok{inv.logit}\NormalTok{(B.tilde }\SpecialCharTok{\%*\%}\NormalTok{ X.lo)}
\NormalTok{s.hi }\OtherTok{\textless{}{-}} \FunctionTok{inv.logit}\NormalTok{(B.tilde }\SpecialCharTok{\%*\%}\NormalTok{ X.hi)}

\NormalTok{s.lo }\OtherTok{\textless{}{-}} \FunctionTok{apply}\NormalTok{(s.lo, }\DecValTok{2}\NormalTok{, quantile, }\FunctionTok{c}\NormalTok{(}\FloatTok{0.025}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\FloatTok{0.975}\NormalTok{))}
\NormalTok{s.hi }\OtherTok{\textless{}{-}} \FunctionTok{apply}\NormalTok{(s.hi, }\DecValTok{2}\NormalTok{, quantile, }\FunctionTok{c}\NormalTok{(}\FloatTok{0.025}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\FloatTok{0.975}\NormalTok{))}


\CommentTok{\# Now tidy the data and plot with ggplot}
\NormalTok{pred.prob.df.int }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{xrange=}\FunctionTok{rep}\NormalTok{(clint96.range,}\DecValTok{2}\NormalTok{), }
                           \AttributeTok{y=}\FunctionTok{c}\NormalTok{(s.lo[}\DecValTok{2}\NormalTok{,],s.hi[}\DecValTok{2}\NormalTok{,]),}
                           \AttributeTok{conf.low =} \FunctionTok{c}\NormalTok{(s.lo[}\DecValTok{1}\NormalTok{,], s.hi[}\DecValTok{1}\NormalTok{,]),}
                           \AttributeTok{conf.high =} \FunctionTok{c}\NormalTok{(s.lo[}\DecValTok{3}\NormalTok{,], s.hi[}\DecValTok{3}\NormalTok{,]),}
                           \AttributeTok{scenario =} \FunctionTok{rep}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"AFL{-}CIO=100"}\NormalTok{, }\StringTok{"AFL{-}CIO=0"}\NormalTok{), }
                                          \AttributeTok{each=}\FunctionTok{length}\NormalTok{(clint96.range)))}

\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{pred.prob.df.int, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{xrange, }\AttributeTok{y=}\NormalTok{y,}
                              \AttributeTok{ymin=}\NormalTok{conf.low,}
                              \AttributeTok{ymax=}\NormalTok{conf.high,}
                              \AttributeTok{fill=}\FunctionTok{factor}\NormalTok{(scenario),}
                              \AttributeTok{linetype=}\FunctionTok{factor}\NormalTok{(scenario))) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\AttributeTok{size=}\NormalTok{.}\DecValTok{8}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_ribbon}\NormalTok{(}\AttributeTok{alpha=}\FloatTok{0.25}\NormalTok{, }\AttributeTok{color=}\StringTok{"gray"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x=}\StringTok{"1996 Vote Share for Clinton"}\NormalTok{, }\AttributeTok{y=}\StringTok{"Predicted Probability"}\NormalTok{,}
       \AttributeTok{title=}\StringTok{"Predicted Probability Plot for Interaction Model"}\NormalTok{, }\AttributeTok{linetype=}\StringTok{"Scenario"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{labels=}\FunctionTok{c}\NormalTok{(}\StringTok{"AFL{-}CIO=100"}\NormalTok{, }\StringTok{"AFL{-}CIO=0"}\NormalTok{), }
                    \AttributeTok{values=}\FunctionTok{c}\NormalTok{(}\StringTok{"blue"}\NormalTok{, }\StringTok{"red"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{guides}\NormalTok{(}\AttributeTok{fill=}\StringTok{"none"}\NormalTok{, }\AttributeTok{color=}\StringTok{"none"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-28-2.pdf}

\hypertarget{comparing-models}{%
\subsubsection{Comparing Models}\label{comparing-models}}

\hypertarget{roc-plots}{%
\subsubsection{ROC Plots}\label{roc-plots}}

Use these to assess model fit heuristically. We want our model's curve
to be as close to a straight diagonal line as possible.

In the below example, because the simpler model performs about as well
as the more complicated one we would opt for the simpler model (assuming
AIC, BIC, etc. are similar)

Note: We can also calculate and compare the Area Under the Curve (AUC)
for each model's ROC curve; smaller is better.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Read in and clean up the data}
\NormalTok{impeach }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"Data/impeach.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 435 Columns: 5
\end{verbatim}

\begin{verbatim}
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## dbl (5): votesum, clint96, partyid, aflcio97, ccoal98
\end{verbatim}

\begin{verbatim}
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{impeach }\OtherTok{\textless{}{-}} \FunctionTok{na.omit}\NormalTok{(impeach)}
\FunctionTok{attach}\NormalTok{(impeach)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## The following objects are masked from impeach (pos = 3):
## 
##     aflcio97, ccoal98, clint96, partyid, votesum
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Make our DV binary}
\NormalTok{impeach}\SpecialCharTok{$}\NormalTok{votebin[votesum }\SpecialCharTok{!=} \DecValTok{0}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Unknown or uninitialised column: `votebin`.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{impeach}\SpecialCharTok{$}\NormalTok{votebin[votesum }\SpecialCharTok{==} \DecValTok{0}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{0}

\CommentTok{\# Define two models to compare, one without aflcio97, one with}
\NormalTok{model1 }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(votebin }\SpecialCharTok{\textasciitilde{}}\NormalTok{ partyid }\SpecialCharTok{+}\NormalTok{ clint96, }\AttributeTok{family=}\FunctionTok{binomial}\NormalTok{(}\AttributeTok{link=}\StringTok{"logit"}\NormalTok{), }\AttributeTok{data=}\NormalTok{impeach)}

\NormalTok{model2 }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(votebin }\SpecialCharTok{\textasciitilde{}}\NormalTok{ partyid }\SpecialCharTok{+}\NormalTok{ clint96 }\SpecialCharTok{+}\NormalTok{ aflcio97, }\AttributeTok{family=}\FunctionTok{binomial}\NormalTok{(}\AttributeTok{link=}\StringTok{"logit"}\NormalTok{), }\AttributeTok{data=}\NormalTok{impeach)}

\CommentTok{\# Get out predicted values for each model}
\NormalTok{model1\_pred }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(model1, impeach, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{)}
\NormalTok{model2\_pred }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(model2, impeach, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{)}
\NormalTok{preds\_list }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(model1\_pred, model2\_pred)}


\NormalTok{m }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(preds\_list)}
\NormalTok{actual\_values }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\FunctionTok{list}\NormalTok{(impeach}\SpecialCharTok{$}\NormalTok{votebin),}\DecValTok{2}\NormalTok{)}

\NormalTok{pred }\OtherTok{\textless{}{-}} \FunctionTok{prediction}\NormalTok{(preds\_list, actual\_values)}
\NormalTok{rocs }\OtherTok{\textless{}{-}} \FunctionTok{performance}\NormalTok{(pred, }\StringTok{"tpr"}\NormalTok{, }\StringTok{"fpr"}\NormalTok{)}
\CommentTok{\#jpeg(file="ROCplot.jpeg")}

\CommentTok{\# Plot it}
\FunctionTok{plot}\NormalTok{(rocs, }\AttributeTok{col =} \FunctionTok{as.list}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\NormalTok{m), }\AttributeTok{main =} \StringTok{"Model 1 and 2 ROC Comparison"}\NormalTok{)}
     \FunctionTok{legend}\NormalTok{(}\AttributeTok{x =} \StringTok{"bottomright"}\NormalTok{,}
            \AttributeTok{legend =} \FunctionTok{c}\NormalTok{(}\StringTok{"Model 1"}\NormalTok{, }\StringTok{"Model 2"}\NormalTok{),}
            \AttributeTok{fill =} \DecValTok{1}\SpecialCharTok{:}\NormalTok{m)}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-29-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#dev.off()}

\CommentTok{\# Calculating the AUC from the predicted values calculated above}
\NormalTok{AUC\_in }\OtherTok{\textless{}{-}} \FunctionTok{performance}\NormalTok{(pred, }\AttributeTok{measure=}\StringTok{"auc"}\NormalTok{)}

\NormalTok{AUC\_labels }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Model 1"}\NormalTok{, }\StringTok{"Model 2"}\NormalTok{)}

\NormalTok{knitr}\SpecialCharTok{::}\FunctionTok{kable}\NormalTok{(}\FunctionTok{cbind}\NormalTok{(AUC\_labels, }\FunctionTok{round}\NormalTok{(}\FunctionTok{as.numeric}\NormalTok{(AUC\_in}\SpecialCharTok{@}\NormalTok{y.values), }\DecValTok{3}\NormalTok{)), }\AttributeTok{col.names =} \FunctionTok{c}\NormalTok{(}\StringTok{""}\NormalTok{, }\StringTok{"AUC"}\NormalTok{),}
      \AttributeTok{caption =} \StringTok{"Model AUCs"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:unnamed-chunk-29}Model AUCs}
\centering
\begin{tabular}[t]{l|l}
\hline
 & AUC\\
\hline
Model 1 & 0.996\\
\hline
Model 2 & 0.998\\
\hline
\end{tabular}
\end{table}

\hypertarget{out-of-sample-prediction}{%
\subsubsection{Out-of-sample
Prediction}\label{out-of-sample-prediction}}

We assess out-of-sample prediction because our model might be overfitted
to the data we feed it. When a model can predict both in-sample and
out-of-sample well then it's more in line with the data generating
process.

What we need to evaluate a model's prediction error (AKA generalization
error, generalization performance): - Training set - Test set - A model
- A loss function to measure deviation from the actual value in the test
set

What we want: - Good performance in both the test and training sets

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Load in some data}
\NormalTok{ms}\OtherTok{\textless{}{-}}\FunctionTok{read.table}\NormalTok{(}\StringTok{"Data/Msrepl87.asc"}\NormalTok{, }\AttributeTok{header=}\ConstantTok{TRUE}\NormalTok{, }
    \AttributeTok{colClasses=}\FunctionTok{c}\NormalTok{(}\StringTok{"character"}\NormalTok{,}\FunctionTok{rep}\NormalTok{(}\StringTok{"numeric"}\NormalTok{,}\DecValTok{22}\NormalTok{)))}
\FunctionTok{rownames}\NormalTok{(ms) }\OtherTok{\textless{}{-}}\NormalTok{ ms}\SpecialCharTok{$}\NormalTok{country}


\CommentTok{\# Create a new variables of interest}
\NormalTok{ms}\SpecialCharTok{$}\NormalTok{sanctions }\OtherTok{\textless{}{-}}\NormalTok{ (ms}\SpecialCharTok{$}\NormalTok{sanctions70 }\SpecialCharTok{+}\NormalTok{ ms}\SpecialCharTok{$}\NormalTok{sanctions75)}\SpecialCharTok{/}\DecValTok{2}
\NormalTok{ms}\SpecialCharTok{$}\NormalTok{deaths }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(ms}\SpecialCharTok{$}\NormalTok{deaths75 }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)}


\CommentTok{\# Create 3 competing logit models}
\NormalTok{model1 }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(deaths }\SpecialCharTok{\textasciitilde{}}\NormalTok{ sanctions, }\AttributeTok{family=}\FunctionTok{binomial}\NormalTok{(}\AttributeTok{link=}\StringTok{"logit"}\NormalTok{), }\AttributeTok{data=}\NormalTok{ms)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model2 }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(deaths }\SpecialCharTok{\textasciitilde{}}\NormalTok{ sanctions }\SpecialCharTok{+}\NormalTok{ pop75 }\SpecialCharTok{+}\NormalTok{ civlib76, }
              \AttributeTok{family=}\FunctionTok{binomial}\NormalTok{(}\AttributeTok{link=}\StringTok{"logit"}\NormalTok{), }\AttributeTok{data=}\NormalTok{ms)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model3 }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(deaths }\SpecialCharTok{\textasciitilde{}}\NormalTok{ sanctions }\SpecialCharTok{+}\NormalTok{ civlib76 }\SpecialCharTok{+}\NormalTok{ pop75 }\SpecialCharTok{+}\NormalTok{ sanctions}\SpecialCharTok{:}\NormalTok{civlib76,}
              \AttributeTok{family=}\FunctionTok{binomial}\NormalTok{(}\AttributeTok{link=}\StringTok{"logit"}\NormalTok{), }\AttributeTok{data=}\NormalTok{ms)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{modelsummary}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\StringTok{"Model 1"}\OtherTok{=}\NormalTok{model1, }\StringTok{"Model 2"}\OtherTok{=}\NormalTok{model2, }\StringTok{"Model 3"}\OtherTok{=}\NormalTok{model3))}
\end{Highlighting}
\end{Shaded}

\begin{table}
\centering
\begin{tabular}[t]{lccc}
\toprule
  & Model 1 & Model 2 & Model 3\\
\midrule
(Intercept) & \num{-0.462} & \num{-0.521} & \num{-1.744}\\
 & (\num{0.372}) & (\num{0.624}) & (\num{0.891})\\
sanctions & \num{0.102} & \num{0.073} & \num{0.314}\\
 & (\num{0.031}) & (\num{0.033}) & (\num{0.133})\\
pop75 &  & \num{0.071} & \num{0.056}\\
 &  & (\num{0.048}) & (\num{0.050})\\
civlib76 &  & \num{-0.059} & \num{0.192}\\
 &  & (\num{0.136}) & (\num{0.177})\\
sanctions × civlib76 &  &  & \num{-0.043}\\
 &  &  & (\num{0.020})\\
\midrule
Num.Obs. & \num{95} & \num{95} & \num{95}\\
AIC & \num{89.4} & \num{89.6} & \num{86.5}\\
BIC & \num{94.5} & \num{99.8} & \num{99.3}\\
Log.Lik. & \num{-42.676} & \num{-40.786} & \num{-38.256}\\
\bottomrule
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Based on the AIC and BIC Model 1 has the best in{-}sample fit}
\CommentTok{\# Now let\textquotesingle{}s use cross{-}validation to assess out{-}of{-}sample fit}

\FunctionTok{set.seed}\NormalTok{(}\DecValTok{1234}\NormalTok{)}

\CommentTok{\# Define number of folds we want}
\NormalTok{k }\OtherTok{\textless{}{-}} \DecValTok{10}

\CommentTok{\# Make the fold assignments, order them, and attach them to the dataset}
\NormalTok{folds }\OtherTok{\textless{}{-}} \FunctionTok{cvFolds}\NormalTok{(}\AttributeTok{n=}\FunctionTok{NROW}\NormalTok{(ms), }\AttributeTok{K=}\NormalTok{k, }\AttributeTok{type=}\StringTok{"random"}\NormalTok{)}
\NormalTok{folds }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\FunctionTok{cbind}\NormalTok{(folds}\SpecialCharTok{$}\NormalTok{subsets, folds}\SpecialCharTok{$}\NormalTok{which))}
\FunctionTok{colnames}\NormalTok{(folds) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"index"}\NormalTok{, }\StringTok{"fold"}\NormalTok{)}
\NormalTok{folds }\OtherTok{\textless{}{-}}\NormalTok{ folds[}\FunctionTok{order}\NormalTok{(folds}\SpecialCharTok{$}\NormalTok{index),]}

\NormalTok{ms}\SpecialCharTok{$}\NormalTok{fold }\OtherTok{\textless{}{-}}\NormalTok{ folds}\SpecialCharTok{$}\NormalTok{fold}

\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ ms }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{preds1 =} \FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(ms)),}
         \AttributeTok{preds2 =} \FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(ms)),}
         \AttributeTok{preds3 =} \FunctionTok{rep}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(ms)))}

\CommentTok{\# Loop through each fold}
\ControlFlowTok{for}\NormalTok{(k\_i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\NormalTok{k)\{}
   
   \CommentTok{\# Get the training data}
\NormalTok{   train\_data }\OtherTok{\textless{}{-}}\NormalTok{ ms }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(fold }\SpecialCharTok{!=}\NormalTok{ k\_i)}
   
   \CommentTok{\# Get the testing data}
\NormalTok{   test\_data }\OtherTok{\textless{}{-}}\NormalTok{ ms }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(fold }\SpecialCharTok{==}\NormalTok{ k\_i)}
   
   \CommentTok{\# Train model 1 and get predictions}
\NormalTok{   trained\_model1 }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(deaths }\SpecialCharTok{\textasciitilde{}}\NormalTok{ sanctions, }\AttributeTok{family=}\FunctionTok{binomial}\NormalTok{(}\AttributeTok{link=}\StringTok{"logit"}\NormalTok{),}
                         \AttributeTok{data=}\NormalTok{train\_data)}
   
\NormalTok{   preds1.vals }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(trained\_model1, test\_data, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{)}
   
\NormalTok{   data[data}\SpecialCharTok{$}\NormalTok{fold }\SpecialCharTok{==}\NormalTok{ k\_i,]}\SpecialCharTok{$}\NormalTok{preds1 }\OtherTok{\textless{}{-}}\NormalTok{ preds1.vals}

   \CommentTok{\# Train model 2 and get predictions}
\NormalTok{   trained\_model2 }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(deaths }\SpecialCharTok{\textasciitilde{}}\NormalTok{ sanctions }\SpecialCharTok{+}\NormalTok{ pop75 }\SpecialCharTok{+}\NormalTok{ civlib76,}
                         \AttributeTok{family=}\FunctionTok{binomial}\NormalTok{(}\AttributeTok{link=}\StringTok{"logit"}\NormalTok{), }\AttributeTok{data=}\NormalTok{ms)}
   
\NormalTok{   preds2.vals }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(trained\_model2, test\_data, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{)}
   
\NormalTok{   data[data}\SpecialCharTok{$}\NormalTok{fold }\SpecialCharTok{==}\NormalTok{ k\_i,]}\SpecialCharTok{$}\NormalTok{preds2 }\OtherTok{\textless{}{-}}\NormalTok{ preds2.vals}

   \CommentTok{\# Train model 3 and get predictions  }
\NormalTok{   trained\_model3 }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(deaths }\SpecialCharTok{\textasciitilde{}}\NormalTok{ sanctions }\SpecialCharTok{+}\NormalTok{ civlib76 }\SpecialCharTok{+}\NormalTok{ pop75 }\SpecialCharTok{+}\NormalTok{ sanctions}\SpecialCharTok{:}\NormalTok{civlib76,}
                         \AttributeTok{family=}\FunctionTok{binomial}\NormalTok{(}\AttributeTok{link=}\StringTok{"logit"}\NormalTok{), }\AttributeTok{data=}\NormalTok{ms)}
   
\NormalTok{   preds3.vals }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(trained\_model3, test\_data, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{)}
   
\NormalTok{   data[data}\SpecialCharTok{$}\NormalTok{fold }\SpecialCharTok{==}\NormalTok{ k\_i,]}\SpecialCharTok{$}\NormalTok{preds3 }\OtherTok{\textless{}{-}}\NormalTok{ preds3.vals}

\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{preds }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{preds1, data}\SpecialCharTok{$}\NormalTok{preds2, data}\SpecialCharTok{$}\NormalTok{preds3)}
\NormalTok{n }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(preds)}

\CommentTok{\# Get the actual values}
\NormalTok{actual\_vals }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\FunctionTok{list}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{deaths), n)}

\CommentTok{\# Make the ROC plot}
\NormalTok{pred\_instance }\OtherTok{\textless{}{-}} \FunctionTok{prediction}\NormalTok{(preds, actual\_vals)}

\CommentTok{\# how to get the actual }
\NormalTok{AUC\_out }\OtherTok{\textless{}{-}} \FunctionTok{performance}\NormalTok{(pred\_instance, }\AttributeTok{measure=}\StringTok{"auc"}\NormalTok{)}

\NormalTok{AUC\_labels }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Model 1"}\NormalTok{, }\StringTok{"Model 2"}\NormalTok{, }\StringTok{"Model 3"}\NormalTok{)}

\FunctionTok{kable}\NormalTok{(}\FunctionTok{cbind}\NormalTok{(AUC\_labels, }\FunctionTok{round}\NormalTok{(}\FunctionTok{as.numeric}\NormalTok{(AUC\_out}\SpecialCharTok{@}\NormalTok{y.values), }\DecValTok{3}\NormalTok{)), }\AttributeTok{col.names =} \FunctionTok{c}\NormalTok{(}\StringTok{""}\NormalTok{, }\StringTok{"AUC"}\NormalTok{),}
      \AttributeTok{caption =} \StringTok{"Out{-}of{-}sample AUCs"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:unnamed-chunk-30}Out-of-sample AUCs}
\centering
\begin{tabular}[t]{l|l}
\hline
 & AUC\\
\hline
Model 1 & 0.827\\
\hline
Model 2 & 0.863\\
\hline
Model 3 & 0.862\\
\hline
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rocs }\OtherTok{\textless{}{-}} \FunctionTok{performance}\NormalTok{(pred\_instance, }\StringTok{"tpr"}\NormalTok{, }\StringTok{"fpr"}\NormalTok{)}
\FunctionTok{plot}\NormalTok{(rocs, }\AttributeTok{col =} \FunctionTok{as.list}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\NormalTok{n), }\AttributeTok{main =} \StringTok{"Out{-}of{-}sample ROC Curves from 10{-}fold CV"}\NormalTok{)}
\FunctionTok{legend}\NormalTok{(}\AttributeTok{x =} \StringTok{"bottomright"}\NormalTok{, }\AttributeTok{legend =} \FunctionTok{c}\NormalTok{(}\StringTok{"Model 1"}\NormalTok{, }\StringTok{"Model 2"}\NormalTok{, }\StringTok{"Model 3"}\NormalTok{),}
       \AttributeTok{fill =} \DecValTok{1}\SpecialCharTok{:}\NormalTok{n)}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-30-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cvFit}\NormalTok{(model1, }\AttributeTok{data=}\NormalTok{ms, }\AttributeTok{y=}\NormalTok{ms}\SpecialCharTok{$}\NormalTok{deaths, }\AttributeTok{K=}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
\end{verbatim}

\begin{verbatim}
## 10-fold CV results:
##       CV 
## 7.623817
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cvFit}\NormalTok{(model2, }\AttributeTok{data=}\NormalTok{ms, }\AttributeTok{y=}\NormalTok{ms}\SpecialCharTok{$}\NormalTok{deaths, }\AttributeTok{K=}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
\end{verbatim}

\begin{verbatim}
## 10-fold CV results:
##       CV 
## 8.625017
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cvFit}\NormalTok{(model3, }\AttributeTok{data=}\NormalTok{ms, }\AttributeTok{y=}\NormalTok{ms}\SpecialCharTok{$}\NormalTok{deaths, }\AttributeTok{K=}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
\end{verbatim}

\begin{verbatim}
## 10-fold CV results:
##       CV 
## 15.88777
\end{verbatim}

\hypertarget{separation-plots}{%
\subsubsection{Separation Plots}\label{separation-plots}}

Use this plot to assess a model's ability to discriminate between cases.
The best model would have all the events (dark red lines) cluster to the
right and non-events (light red lines) cluster to the left.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Generate predicted values for each model}
\NormalTok{model1\_pred }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(model1, ms, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{)}
\NormalTok{model2\_pred }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(model2, ms, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{)}
\NormalTok{model3\_pred }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(model3, ms, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{)}

\CommentTok{\# Note: the separationplot library doesn\textquotesingle{}t seem to allow multiple plots in the same chunk or like any attempts to save the plots using R functions}
\FunctionTok{separationplot}\NormalTok{(model1\_pred, ms}\SpecialCharTok{$}\NormalTok{deaths, }\AttributeTok{heading=}\StringTok{"Model 1 Separation Plot"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{separationplot}\NormalTok{(model2\_pred, ms}\SpecialCharTok{$}\NormalTok{deaths, }\AttributeTok{heading=}\StringTok{"Model 2 Separation Plot"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{separationplot}\NormalTok{(model3\_pred, ms}\SpecialCharTok{$}\NormalTok{deaths, }\AttributeTok{heading=}\StringTok{"Model 3 Separation Plot"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{ordered-categorical-variable-models}{%
\subsection{Ordered Categorical Variable
Models}\label{ordered-categorical-variable-models}}

\hypertarget{ordered-logit}{%
\subsubsection{Ordered Logit}\label{ordered-logit}}

Binary logit is just a special case of ordered logit. Because our \(Y\)
is discretized, the probability density function for this model is a
piecewise function. The likelihood function then becomes a product of
binary logit models (see pg. 143-144 of Ward and Ahlquist 2018). Like
binary logit, ordered logit assumes the errors follow a logistic
distribution whereas probit assumes normally distributed errors.

See pg. 146-154 of Ward and Ahlquist (2018) for examples of interpreting
the confusing output an ordered logit model.

Note: The derivation of the MLE for ordered logit is sufficiently
complex that I doubt it would be asked on the exam.

An example in R:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{drury }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"Data/drury\_jpr\_data.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 116 Columns: 26
\end{verbatim}

\begin{verbatim}
## -- Column specification --------------------------------------------------------
## Delimiter: ","
## dbl (26): blknight, case, contrib, coop, cost, dstres, gnpcst, gnprat, inst,...
\end{verbatim}

\begin{verbatim}
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model\_logit\_drury }\OtherTok{\textless{}{-}} \FunctionTok{polr}\NormalTok{(}\FunctionTok{as.ordered}\NormalTok{(result) }\SpecialCharTok{\textasciitilde{}} \FunctionTok{log}\NormalTok{(gnprat) }\SpecialCharTok{+}\NormalTok{ trade }\SpecialCharTok{+}\NormalTok{ tarcst }\SpecialCharTok{+}\NormalTok{ cost }\SpecialCharTok{+}\NormalTok{ coop, }
                   \AttributeTok{method=}\StringTok{"logistic"}\NormalTok{, }\AttributeTok{data=}\NormalTok{drury, }\AttributeTok{Hess=}\NormalTok{T)}

\FunctionTok{modelsummary}\NormalTok{(model\_logit\_drury)}
\end{Highlighting}
\end{Shaded}

\begin{table}
\centering
\begin{tabular}[t]{lc}
\toprule
  & Model 1\\
\midrule
log(gnprat) & \num{0.037}\\
 & (\num{0.089})\\
trade & \num{0.011}\\
 & (\num{0.005})\\
tarcst & \num{0.000}\\
 & (\num{0.000})\\
cost & \num{-0.105}\\
 & (\num{0.257})\\
coop & \num{-0.331}\\
 & (\num{0.187})\\
1|2 & \num{-1.391}\\
 & (\num{0.706})\\
2|3 & \num{-0.048}\\
 & (\num{0.686})\\
3|4 & \num{0.730}\\
 & (\num{0.690})\\
\midrule
Num.Obs. & \num{116}\\
AIC & \num{319.7}\\
BIC & \num{341.7}\\
Log.Lik. & \num{-151.834}\\
edf & \num{8.000}\\
\bottomrule
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{attach}\NormalTok{(drury)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## The following object is masked _by_ .GlobalEnv:
## 
##     trade
\end{verbatim}

\begin{verbatim}
## The following object is masked from package:fixest:
## 
##     trade
\end{verbatim}

\begin{verbatim}
## The following object is masked from package:MASS:
## 
##     coop
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{X.coop1 }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(}\FunctionTok{median}\NormalTok{(}\FunctionTok{log}\NormalTok{(gnprat)), }\FunctionTok{median}\NormalTok{(drury}\SpecialCharTok{$}\NormalTok{trade), }\FunctionTok{median}\NormalTok{(tarcst), }\FunctionTok{median}\NormalTok{(cost), }\FunctionTok{min}\NormalTok{(coop)) }\CommentTok{\# coop = 1 scenario}

\NormalTok{X.coop4 }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(}\FunctionTok{median}\NormalTok{(}\FunctionTok{log}\NormalTok{(gnprat)), }\FunctionTok{median}\NormalTok{(drury}\SpecialCharTok{$}\NormalTok{trade), }\FunctionTok{median}\NormalTok{(tarcst), }\FunctionTok{median}\NormalTok{(cost), }\FunctionTok{max}\NormalTok{(coop)) }\CommentTok{\# coop = 4 scenario}

\NormalTok{draws}\OtherTok{\textless{}{-}}\FunctionTok{mvrnorm}\NormalTok{(}\DecValTok{1000}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\FunctionTok{coef}\NormalTok{(model\_logit\_drury),model\_logit\_drury}\SpecialCharTok{$}\NormalTok{zeta),}
               \FunctionTok{solve}\NormalTok{(model\_logit\_drury}\SpecialCharTok{$}\NormalTok{Hessian))}

\NormalTok{B}\OtherTok{\textless{}{-}}\NormalTok{draws[,}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(}\FunctionTok{coef}\NormalTok{(model\_logit\_drury))]}

\NormalTok{Taus}\OtherTok{\textless{}{-}}\NormalTok{draws[,(}\FunctionTok{length}\NormalTok{(}\FunctionTok{coef}\NormalTok{(model\_logit\_drury))}\SpecialCharTok{+}\DecValTok{1}\NormalTok{)}\SpecialCharTok{:}\FunctionTok{ncol}\NormalTok{(draws)]}

\NormalTok{pi.cutoff12.coop1 }\OtherTok{\textless{}{-}} \FunctionTok{plogis}\NormalTok{(Taus[,}\DecValTok{2}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{ B}\SpecialCharTok{\%*\%}\FunctionTok{t}\NormalTok{(X.coop1)) }\SpecialCharTok{{-}} \FunctionTok{plogis}\NormalTok{(Taus[,}\DecValTok{1}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{ B}\SpecialCharTok{\%*\%}\FunctionTok{t}\NormalTok{(X.coop1))}
\NormalTok{pi.cutoff12.coop4 }\OtherTok{\textless{}{-}} \FunctionTok{plogis}\NormalTok{(Taus[,}\DecValTok{2}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{ B}\SpecialCharTok{\%*\%}\FunctionTok{t}\NormalTok{(X.coop4)) }\SpecialCharTok{{-}} \FunctionTok{plogis}\NormalTok{(Taus[,}\DecValTok{1}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{ B}\SpecialCharTok{\%*\%}\FunctionTok{t}\NormalTok{(X.coop4))}
\NormalTok{pi.cutoff23.coop1 }\OtherTok{\textless{}{-}} \FunctionTok{plogis}\NormalTok{(Taus[,}\DecValTok{3}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{ B}\SpecialCharTok{\%*\%}\FunctionTok{t}\NormalTok{(X.coop1)) }\SpecialCharTok{{-}} \FunctionTok{plogis}\NormalTok{(Taus[,}\DecValTok{2}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{ B}\SpecialCharTok{\%*\%}\FunctionTok{t}\NormalTok{(X.coop1))}
\NormalTok{pi.cutoff23.coop4 }\OtherTok{\textless{}{-}} \FunctionTok{plogis}\NormalTok{(Taus[,}\DecValTok{3}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{ B}\SpecialCharTok{\%*\%}\FunctionTok{t}\NormalTok{(X.coop4)) }\SpecialCharTok{{-}} \FunctionTok{plogis}\NormalTok{(Taus[,}\DecValTok{2}\NormalTok{] }\SpecialCharTok{{-}}\NormalTok{ B}\SpecialCharTok{\%*\%}\FunctionTok{t}\NormalTok{(X.coop4))}

\CommentTok{\# result = 2 first difference}
\NormalTok{fd.res2 }\OtherTok{\textless{}{-}}\NormalTok{ pi.cutoff12.coop4 }\SpecialCharTok{{-}}\NormalTok{ pi.cutoff12.coop1}
\CommentTok{\# result = 3 first difference}
\NormalTok{fd.res3 }\OtherTok{\textless{}{-}}\NormalTok{ pi.cutoff23.coop4 }\SpecialCharTok{{-}}\NormalTok{ pi.cutoff23.coop1}

\FunctionTok{plot}\NormalTok{(}\FunctionTok{density}\NormalTok{(fd.res3, }\AttributeTok{adjust=}\FloatTok{1.5}\NormalTok{), }\AttributeTok{xlim=}\FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.2}\NormalTok{,}\FloatTok{0.2}\NormalTok{),}\AttributeTok{ylim=}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{25}\NormalTok{),}
     \AttributeTok{xlab=}\StringTok{"Change in predicted probability"}\NormalTok{, }\AttributeTok{bty=}\StringTok{"n"}\NormalTok{, }\AttributeTok{col=}\DecValTok{1}\NormalTok{,}
     \AttributeTok{yaxt=}\StringTok{"n"}\NormalTok{, }\AttributeTok{lwd=}\DecValTok{2}\NormalTok{, }\AttributeTok{main=}\StringTok{"First Difference Change in Probability}\SpecialCharTok{\textbackslash{}n}\StringTok{ from Changing coop=4 to coop=1"}\NormalTok{,}
     \AttributeTok{ylab=}\StringTok{""}\NormalTok{)}
\FunctionTok{lines}\NormalTok{(}\FunctionTok{density}\NormalTok{(fd.res2, }\AttributeTok{adjust=}\FloatTok{1.5}\NormalTok{), }\AttributeTok{col=}\FunctionTok{grey}\NormalTok{(}\FloatTok{0.5}\NormalTok{), }\AttributeTok{lwd=}\DecValTok{2}\NormalTok{, }\AttributeTok{lty=}\DecValTok{2}\NormalTok{)}
\FunctionTok{text}\NormalTok{(}\AttributeTok{x=}\FloatTok{0.1}\NormalTok{, }\AttributeTok{y=}\DecValTok{20}\NormalTok{, }\AttributeTok{labels=}\StringTok{"Dashed: Pr(result=2 | coop=4) {-}}
\StringTok{     }\SpecialCharTok{\textbackslash{}n}\StringTok{ Pr(result=2 | coop=1)"}\NormalTok{,}\AttributeTok{cex=}\NormalTok{.}\DecValTok{8}\NormalTok{)}
\FunctionTok{text}\NormalTok{(}\AttributeTok{x=}\SpecialCharTok{{-}}\FloatTok{0.1}\NormalTok{, }\AttributeTok{y=}\DecValTok{20}\NormalTok{, }\AttributeTok{labels=}\StringTok{"Solid: Pr(result=3 | coop=4) {-}}
\StringTok{     }\SpecialCharTok{\textbackslash{}n}\StringTok{ Pr(result=3 | coop=1)"}\NormalTok{,}\AttributeTok{cex=}\NormalTok{.}\DecValTok{8}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-35-1.pdf}

The above plot shows the changes in probability of the \texttt{result}
of sanctions being 3 and 4 when a country has \texttt{coop} = 1 (no
cooperation) versus having \texttt{coop} = 4 (major trading partners
making major efforts to limit trade). This change in \texttt{coop}
appears to decrease the probability that a country falls into category 3
of \texttt{result} as the solid distribution above is centered to the
left of 0. This makes sense given the large and negative coefficient on
\texttt{coop} in the ordered logit model in the table above. The same
change in \texttt{coop} may slightly increase the probability of being
categorized as \texttt{result} = 2 as the dashed distribution above
appears to be centered slightly to the right of 0.

\hypertarget{multinomial-logit}{%
\subsubsection{Multinomial Logit}\label{multinomial-logit}}

When are DV is binned into non-ordinal categories we can use a
multinomial logit model.

Again, the derivation of the likelihood function for this class of
models is fairly complicated (and taking its derivative analytically
would be a nightmare) and so I'd guess it's unlikely to be asked on the
exam. See pg. 163-164 of Ward and Ahlquist (2018) for the relevant
definitions.

\hypertarget{independence-of-irrelevant-alternatives-iia}{%
\paragraph{Independence of Irrelevant Alternatives
(IIA)}\label{independence-of-irrelevant-alternatives-iia}}

IIA is an assumption baked in to the standard multinomial logit model.
It just means if we have some choices A and B for the DV then
introducing some C won't change the relative likelihood of someone
choosing A over B.

\hypertarget{interpretation}{%
\paragraph{Interpretation}\label{interpretation}}

Like with ordered logit, interpretation is kind of a nightmare.
Essentially, each coefficient is the logit coefficient w.r.t. the
excluded (reference) category of the DV for those columns of the BUTON.
See pg. 169 of Ward and Ahlquist (2018) for an example of this. The
first two columns of Table 9.1 present the logit coefficient of the
given category w.r.t Labor.

\hypertarget{count-data}{%
\subsection{Count Data}\label{count-data}}

Count models are used to describe count data (\(Y\in{0,1,2, . . .}\)).
Count data is discrete and bounded from below.

\hypertarget{why-not-use-ols}{%
\subsubsection{Why not use OLS?}\label{why-not-use-ols}}

This is a bad idea for the same reason it's a bad idea to use OLS with
binary data:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  The variance of a count increases with the mean (more error around
  larger values) and thus count data is heteroskedastic.
\item
  OLS will generate predictions that aren't lower bounded at 0 or
  integers. This can be worked around by logging the DV but then you
  have to deal with \(\log(0)\). Do you discard these observations? Do
  you add some arbitrary constant to every value of your DV?
\end{enumerate}

\hypertarget{poisson-regression}{%
\subsubsection{Poisson Regression}\label{poisson-regression}}

\hypertarget{the-poisson-distribution}{%
\paragraph{The Poisson Distribution}\label{the-poisson-distribution}}

Assumptions:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Events occur independently.
\item
  There is a constant arrival rate of events, \(\lambda\). The
  probability of an event occurring in the interval \((t,t+h]\) is then
  \(h\lambda\) (probability of a no event is \(1-\lambda h\))
\end{enumerate}

The distribution is then:

\[Y\sim f_p(y;\lambda,h)\]
\[Pr(Y=y)=\frac{e^{-h\lambda}(h\lambda)^y}{y!}\] where
\(\lambda>0, h>0\)

This is our \emph{stochastic/random} component. The systematic component
is some continuous or discrete set of IVs, \(X\), that are linear in
parameters (i.e.~not squared, divided, etc.).

The mean and variance of the Poisson distribution is:
\(E[Y]=var(Y)=h\lambda\)

If all observational intervals are the same length then we can let
\(h=1\) and the distribution simplifies to:

\[Pr(Y=y)=\frac{e^{-\lambda}\lambda^y}{y!}\]

The mean and variance of the Poisson distribution is then:
\(E[Y]=var(Y)=\lambda\)

\hypertarget{the-poisson-model}{%
\paragraph{The Poisson Model}\label{the-poisson-model}}

To incorporate covariates into a Poisson model where the mean is greater
than zero, we need a link function to map our covariates, \(x_i\), onto
positive values. We use the exponential function:

\[E[Y_i]=h\lambda_i=he^{x_i^T\beta}\]

Or when \(h=1\):

\[E[Y_i]=\lambda_i=e^{x_i^T\beta}\]

Plugging this value of \(\lambda\) into our probability mass function we
found defined above we get:

\[Pr(Y_i=y|x_i)=\frac{e^{-e^{x_i^T\beta}}[e^{x_i^T\beta}]^y} {y!}\]

We then derive the likelihood as follows:

\[\mathcal{L}(\beta|X,y)=\prod_{i=1}^n\frac{e^{-e^{x_i^T\beta}}[e^{x_i^T \beta}]^{y_i}}{y_i!}\]

Take the log:

\[\ln\mathcal{L}=\sum_{i=1}^n [e^{x_i^T\beta} + y_ix_i^T\beta - \ln(y_i!)]\]

We can drop the \(\ln(y_i!)\) as it's not a function of what we're
trying to maximize (\(\beta\))

The score equation is:

\[\frac{\partial\ln\mathcal{L}}{\partial\beta}=\sum_{i=1}^n y_ix_i^T\beta-x_i^T\beta e^{x_i^T\beta}=\sum_{i=1}^n(y_i-e^{x_i^T\beta})x_i=0\]

\hypertarget{differential-exposure}{%
\paragraph{Differential exposure}\label{differential-exposure}}

When observations have different exposure windows (i.e.~\(h\) is not
constant across observational units) then we would expect their counts
to be proportional to their exposure window. We have two choices for
accounting for this:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Offset: Include the size of the exposure window in the regression but
  constrain its coefficient to be 1.0
  i.e.~\(\lambda_i=e^{x_i^T\beta+\ln(h_i)}\)
\end{enumerate}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Control: Simply add the (log) of the exposure for each unit as a
  control in the regression
\end{enumerate}

\hypertarget{interpretation-1}{%
\paragraph{Interpretation}\label{interpretation-1}}

As with other non-linear models, directly interpreting coefficients
isn't the way to go. Instead, construct scenarios and generate predicted
values to interpret results.

An example in R:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Load in the data}
\NormalTok{ms}\OtherTok{\textless{}{-}}\FunctionTok{read.table}\NormalTok{(}\StringTok{"Data/Msrepl87.asc"}\NormalTok{, }\AttributeTok{header=}\ConstantTok{TRUE}\NormalTok{, }
    \AttributeTok{colClasses=}\FunctionTok{c}\NormalTok{(}\StringTok{"character"}\NormalTok{,}\FunctionTok{rep}\NormalTok{(}\StringTok{"numeric"}\NormalTok{,}\DecValTok{22}\NormalTok{)))}
\FunctionTok{rownames}\NormalTok{(ms) }\OtherTok{\textless{}{-}}\NormalTok{ ms}\SpecialCharTok{$}\NormalTok{country}

\CommentTok{\# Generate Poisson model}
\NormalTok{model\_poisson }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(deaths75 }\SpecialCharTok{\textasciitilde{}}\NormalTok{ sanctions75 }\SpecialCharTok{+}\NormalTok{ pop75 }\SpecialCharTok{+}\NormalTok{ civlib76, }\AttributeTok{data=}\NormalTok{ms,}
                     \AttributeTok{family=}\StringTok{"poisson"}\NormalTok{)}

\FunctionTok{modelsummary}\NormalTok{(model\_poisson, }\AttributeTok{title=}\StringTok{"Poisson Model"}\NormalTok{, }\AttributeTok{stars=}\NormalTok{T)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: In version 0.8.0 of the `modelsummary` package, the default significance markers produced by the `stars=TRUE` argument were changed to be consistent with R's defaults.
## This warning is displayed once per session.
\end{verbatim}

\begin{table}

\caption{\label{tab:unnamed-chunk-36}Poisson Model}
\centering
\begin{tabular}[t]{lc}
\toprule
  & Model 1\\
\midrule
(Intercept) & \num{-0.019}\\
 & (\num{0.015})\\
sanctions75 & \num{0.005}***\\
 & \vphantom{1} (\num{0.000})\\
pop75 & \num{-0.001}***\\
 & (\num{0.000})\\
civlib76 & \num{1.455}***\\
 & (\num{0.002})\\
\midrule
Num.Obs. & \num{95}\\
AIC & \num{1844141.9}\\
BIC & \num{1844152.1}\\
Log.Lik. & \num{-922066.951}\\
\bottomrule
\multicolumn{2}{l}{\rule{0pt}{1em}+ p $<$ 0.1, * p $<$ 0.05, ** p $<$ 0.01, *** p $<$ 0.001}\\
\end{tabular}
\end{table}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Now make a predicted value plot to interpret the effect of sanctions75}
\CommentTok{\# on the probability of a death occurring}

\CommentTok{\# Note this function automatically holds other IVs at their mean.}

\FunctionTok{effect\_plot}\NormalTok{(model\_poisson, }\AttributeTok{pred=}\StringTok{"sanctions75"}\NormalTok{, }\AttributeTok{interval=}\NormalTok{T) }\SpecialCharTok{+} \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-36-1.pdf}

\hypertarget{diagnostics}{%
\paragraph{Diagnostics}\label{diagnostics}}

The Poisson distribution assumes that the level of heteroskedasticity
will be constant. i.e.~the variance will increase 1:1 with the mean of
count data. This restrictive assumption is expressed as follows:

\[E[Y]=\mathrm{var}(Y)\]

We call it over-dispersion when \(E[Y]<\mathrm{var}(Y)\) (most common)
and under-dispersion when \(E[Y]>\mathrm{var}(Y)\).

Obviously comparing the mean and variance of the DV is one way to assess
dispersion. We can also use the \texttt{dispersiontest()} function from
the \texttt{AER} library:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{AER}\SpecialCharTok{::}\FunctionTok{dispersiontest}\NormalTok{(model\_poisson, }\AttributeTok{alternative=}\StringTok{"two.sided"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Dispersion test
## 
## data:  model_poisson
## z = 1.2539, p-value = 0.2099
## alternative hypothesis: true dispersion is not equal to 1
## sample estimates:
## dispersion 
##   112512.2
\end{verbatim}

To visually check for disperion we can use a Poissonness plot. Similar
to a QQ plot, a perfectly dispersed DV will create a straight line in
the plot. The Poissonness plot, however, does not tell us much about
over-dispersion. For that we can use a hanging rootogram.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# vcd has the distplot function to create a Poissonness plot but I went ahead and }
\CommentTok{\# adapted it to output a ggplot}

\NormalTok{plotness}\SpecialCharTok{::}\FunctionTok{plotness}\NormalTok{(ms}\SpecialCharTok{$}\NormalTok{deaths75)}
\end{Highlighting}
\end{Shaded}

\includegraphics{MethodsCompNotes_files/figure-latex/unnamed-chunk-38-1.pdf}

\hypertarget{dealing-with-over-dispersion}{%
\paragraph{Dealing with
over-dispersion}\label{dealing-with-over-dispersion}}

So we have over-dispersion, what do we do?

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Quasipoisson: Allows generating generating predicted counts and
  uncertainty estimates (which will be larger than a Poisson model) but
  without being able to assess model fit with information criteria or
  maximized likelihood.
\item
  Negative binomial: A model in which \(\lambda_i\) is a random variable
  distributed as a gamma distribution but \(Y_i\), conditional on
  \(\lambda_i\), is still Poisson
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Generate Poisson model}
\NormalTok{model\_poisson }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(deaths75 }\SpecialCharTok{\textasciitilde{}}\NormalTok{ sanctions75 }\SpecialCharTok{+}\NormalTok{ pop75 }\SpecialCharTok{+}\NormalTok{ civlib76, }\AttributeTok{data=}\NormalTok{ms,}
                     \AttributeTok{family=}\StringTok{"poisson"}\NormalTok{)}

\CommentTok{\# Generate Poisson model}
\NormalTok{model\_quasipoisson }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(deaths75 }\SpecialCharTok{\textasciitilde{}}\NormalTok{ sanctions75 }\SpecialCharTok{+}\NormalTok{ pop75 }\SpecialCharTok{+}\NormalTok{ civlib76, }\AttributeTok{data=}\NormalTok{ms,}
                     \AttributeTok{family=}\StringTok{"quasipoisson"}\NormalTok{)}


\CommentTok{\# Generate negative binomial model}
\NormalTok{model\_negbin }\OtherTok{\textless{}{-}} \FunctionTok{glm.nb}\NormalTok{(deaths75 }\SpecialCharTok{\textasciitilde{}}\NormalTok{ sanctions75 }\SpecialCharTok{+}\NormalTok{ pop75 }\SpecialCharTok{+}\NormalTok{ civlib76, }\AttributeTok{data=}\NormalTok{ms)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: glm.fit: algorithm did not converge

## Warning: glm.fit: algorithm did not converge

## Warning: glm.fit: algorithm did not converge

## Warning: glm.fit: algorithm did not converge

## Warning: glm.fit: algorithm did not converge
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{modelsummary}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\StringTok{"Poisson Model"}\OtherTok{=}\NormalTok{model\_poisson, }
                  \StringTok{"Quasipoisson Model"}\OtherTok{=}\NormalTok{model\_quasipoisson, }
                  \StringTok{"Neg. Bin. Model"}\OtherTok{=}\NormalTok{model\_negbin), }
             \AttributeTok{title=}\StringTok{"Count Data Models"}\NormalTok{, }\AttributeTok{stars=}\NormalTok{T)}
\end{Highlighting}
\end{Shaded}

\begin{table}

\caption{\label{tab:unnamed-chunk-39}Count Data Models}
\centering
\begin{tabular}[t]{lccc}
\toprule
  & Poisson Model & Quasipoisson Model & Neg. Bin. Model\\
\midrule
(Intercept) & \num{-0.019} & \num{-0.019} & \num{0.070}\\
 & (\num{0.015}) & (\num{5.206}) & (\num{0.669})\\
sanctions75 & \num{0.005}*** & \num{0.005} & \num{0.047}***\\
 & (\num{0.000}) & (\num{0.005}) & (\num{0.003})\\
pop75 & \num{-0.001}*** & \num{-0.001} & \num{-0.010}*\\
 & (\num{0.000}) & (\num{0.013}) & (\num{0.004})\\
civlib76 & \num{1.455}*** & \num{1.455}+ & \num{1.164}***\\
 & (\num{0.002}) & (\num{0.792}) & (\num{0.145})\\
\midrule
Num.Obs. & \num{95} & \num{95} & \num{95}\\
AIC & \num{1844141.9} & \num{NA} & \num{961.4}\\
BIC & \num{1844152.1} & \num{NA} & \num{974.1}\\
Log.Lik. & \num{-922066.951} & \num{NA} & \num{-475.682}\\
\bottomrule
\multicolumn{4}{l}{\rule{0pt}{1em}+ p $<$ 0.1, * p $<$ 0.05, ** p $<$ 0.01, *** p $<$ 0.001}\\
\end{tabular}
\end{table}

\hypertarget{dealing-with-under-dispersion}{%
\paragraph{Dealing with
under-dispersion}\label{dealing-with-under-dispersion}}

See Ward and Ahlquist (2018) for: Hurdle models (pg. 210) and
zero-inflation models (pg. 211-212).

\hypertarget{exam-questions-and-answers}{%
\section{2021 Exam Questions and
Answers}\label{exam-questions-and-answers}}

\end{document}
